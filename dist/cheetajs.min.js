/*! cheetajs 2013-11-29 */
var $cheeta={};window.$cheeta=$cheeta,$cheeta.model={Model:function(a,b){return{__children:{},__value:null,__bindings:{},__name:b,__parent:a,get length(){return null==this.__value?0:this.__value.length}}},ArrayModel:function(a,b){var c={push:function(){var a=this.__value.length;this.__value.push.apply(this.__value,arguments);var b=this.__value.length;$cheeta.model.update(this,a,b);for(var c=a;b>c;c++)this[c]=this.__value[c]},pop:function(){var a=this.__value.length;this.__value.pop.apply(this.__value,arguments);var b=this.__value.length;$cheeta.model.update(this,a,b)},splice:function(){var a=this.__value.length;this.__value.splice.apply(this.__value,arguments);var b=this.__value.length;$cheeta.model.update(this,a,b);for(var c=0;c<this.__value.length;c++)this[c]!=this.__value[c]&&(this[c]=this.__value[c])}},d=new $cheeta.Model(a,b);for(var e in c)d[e]=c[e];return d},forEachElem:function(a,b){for(var c in a.__bindings)for(var d=a.__bindings[c],e=0;e<d.length;e++){var f=d[e].elem;b.apply(a,[f])}},hasChildren:function(a){for(var b in a.__children)return!0;return!1},bindElement:function(a,b,c,d,e,f){var g=a.__children[d];return null==g&&(g=f?new this.ArrayModel(a,name):new this.Model(a,name),f&&(b.style.display="none"),a.__children[d]=g,g.__name=d),null==g.__bindings[e||d]&&(g.__bindings[e||d]=[]),g.__bindings[e||d].push({elem:b,attr:c}),void 0===a[d]&&(null==a.__parent&&(window[d]=g),Object.defineProperty(a,d,{get length(){return this.__children[d].__value.length},set:function(a){var b=this.__children[d];if(!(a instanceof Object)&&b.__hasChildren()&&null!=a)throw"Cannot set primitive value for model "+d;if(f){var c=b.__value.length;b.__value=a;var e=b.__value.length;$cheeta.model.updateArray(b,c,e)}else b.__value=a,$cheeta.model.update(b);if(a instanceof Object)for(var g in a)b[g]=a[g]},get:function(){var a=this.__children[d];return null==a.__value||a.__value instanceof Object?a:a.__value},enumerable:!0,configurable:!0})),g},toExpr:function(a){for(var b=a.name,c=a.__parent;null!=c&&null!=c.name;)b=name+"."+b,c=c.__parent;return b},bind:function(a,b,c,d,e){if("."===b.charAt(0))for(key in a[0].__bindings){b=key+b;break}null==a&&(a=[$cheeta.model.root]);var f=b.split(/\./g);b=f[f.length-1];for(var g=f[0],h=$cheeta.model.root,i=0;i<a.length&&(h=a[i],h=function(a,b){for(;a!=$cheeta.model.root;){for(var c in a.__bindings)if(c==b)return a;a=a.__parent}return a}(h,g),h==$cheeta.model.root);i++);for(var j=h==$cheeta.model.root?0:1;j<f.length-1;j++)null==h[f[j]]&&this.bindElement(h,c,"",f[j]),h=h[f[j]];return h.__bindElement(c,d,b,as,e),e&&(h.__children[b].__parentModels=[h].concat(a)),h.__children[b]}},$cheeta.model.root=new $cheeta.model.Model(null,"ROOT"),$cheeta.directives=[],$cheeta.onload=function(){$cheeta.compiler.compile(),$cheeta.location.init()},window.addEventListener("load",$cheeta.onload,!1),$cheeta.compiler={recursiveCompile:function(a,b,c){if(b){var d=a;1===b.nodeType&&(d=this.compileDirectives(a,b)),this.recursiveCompile(d,b.firstChild),c||this.recursiveCompile(a,b.nextSibling)}},findDirective:function(a,b){return a.getAttribute(b+".")||a.getAttribute("data-"+b+".")},compileDirectives:function(a,b){for(var c=0;c<b.attributes.length;c++){var d=b.attributes[c];if(d.specified&&-1!==d.name.indexOf(".",d.name.length-1)){var e=d.name.substring(0,d.name.length-1);0==e.indexOf("data-")&&(e=e.substring("data-".length));var f=$cheeta.directives[e]||$cheeta.directives[""];a=(f(d.value,b,a)||[]).concat(a)}}return a},compile:function(){scripts=document.getElementsByTagName("script");for(var i=0;i<scripts.length;i++){var script=scripts[i];"text/cj-template"===script.getAttribute("type")&&($cheeta.templates[script.getAttribute("id")]=script.innerHTML)}var root=document.documentElement;this.recursiveCompile([],root);for(var i=0;i<$cheeta.futureEvals.length;i++)eval($cheeta.futureEvals[i])}},$cheeta.onload=function(){$cheeta.compiler.compile(),$cheeta.location.init()},window.addEventListener("load",$cheeta.onload,!1),$cheeta.location={keyval:{},watchers:{},watch:function(a,b){a instanceof Function&&(b=a,a=""),null==this.watchers[a]&&(this.watchers[a]=[]),this.watchers[a].push(b)},unwatch:function(a,b){b instanceof Function&&(a=b,b="");var c=this.watchers[b];if(null!=c){var d=c.indexOf(a);d>-1&&c.splice(d,1)}},notify:function(a,b,c){var d=this.watchers[a];if(null!=d)for(var e=0;e<d.length;e++)d[e](b,c)},set:function(a,b){void 0==b&&(b=a,a="");var c=this.keyval[a];this.keyval[a]=b,window.location.hash=this.toHash(),this.notify(a,b,c)},toHash:function(){var a=this.keyval[""]||"";for(var b in this.keyval)b.length>0&&(a+=(a.length>0?"&":"")+b+"="+this.keyval[b]);return a},init:function(){var a=this;window.addEventListener("hashchange",function(){var b,c=window.location.hash,d=0,e="",f={};c=c.substring(c.length>1&&"&"==c.charAt(2)?2:1);for(var g=0;g<=c.length;g++)if("&"==c.charAt(g)||g==c.length){if(b=c.substring(d,g),null==a.keyval[e]||a.keyval[e]!=b){var h=a.keyval[e];a.keyval[e]=b,a.notify(e,b,h)}d=g+1,f[e]=!0,e=""}else"="==c.charAt(g)&&(e=c.substring(d,g),d=g+1);for(var e in a.keyval)if(null==f[e]){var h=a.keyval[e];delete a.keyval[e],a.notify(e,null,h)}},!1)}},$cheeta.directives.ctrl=$cheeta.directives.bind=function(a,b,c){for(var d=a.split(/ *; */g),e=[],f=0;f<d.length;f++){var a=d[f];split=a.split(/ +as +/g);var g=split[0],h=split.length>1?split[1]:null;e.push($cheeta.model.bind(c,g,{elem:b,attr:"ctrl",as:h}))}return e},$cheeta.directives[""]=function(def,elem,parentModels,attr,attrName){this.parseExpr=function(a,b){for(var c=null,d=!1,e="",f=-1,g=a.charAt(h),h=0;h<a.length;h++)if(null!=c)g==quote&&"\\"!=a.charAt(h-1)&&("/"==quote&&(d=!0),quote=null),e+=g;else if(d)"a">g&&g>"z"&&(d=!1),e+=g;else if(" "==g||"	"==g||"\r"==g||"\n"==g||"!"==g||'"'==g||g>="%"&&"/">=g||g>=":"&&"?">=g){if(("'"==g||'"'==g||"/"==g)&&(quote=g),f>-1){var i=a.substring(f,h),j=b(i);e+=null!=m?j:i,f=-1}e+=g}else-1==f&&(f=h);return e};var expr=this.parseExpr(def,function(name){return $cheeta.model.bind(parentModels,name,{elem:elem,attr:attrName,bindAttr:attr.name,update:function(model){var val=eval(this.elem.getAttribute(bindAttr));"text"===this.attr?(this.elem.innerHTML="",this.elem.appendChild(document.createTextNode(val))):"html"===this.attr?this.elem.innerHTML=val:("value"===this.attr&&void 0!==this.elem.value&&(this.elem.value=val||null),this.elem.setAttribute(this.attr,val))}}).__toExpr()});elem.setAttribute(attr.name,expr)},$cheeta.futureEvals=[],$cheeta.directives.eval=function(a){$cheeta.futureEvals.push(a)},$cheeta.directives["for"]=function(a,b,c){var d,e,f,g=a.split(/ +in +/g);d=g[1],e=g[0],g=d.split(/ +as +/g),d=g[0],f=g.length>1?g[1]:null,$cheeta.model.bind(c,d,{elem:b,arrayVar:e,arrayName:d,as:f,update:function(a,b,c){if(c.length>b.length)for(var d=c.length-1;d>=b.length;d--)$cheeta.model.forEachElem(a.__children[d],function(a){a.parentNode.removeChild(a),delete this.__parent.__children[d],delete this.__parent[d]});else if(c.length<b.length){var e=this.arrayVar,f=this.arrayName,g=this.elem.getAttribute("bind.")?this.elem.getAttribute("bind.").value:"";g+=this.elem.getAttribute("data-bind.")?this.elem.getAttribute("data-bind.").value:"";for(var d=c.length;d<b.length;d++)$cheeta.model.forEachElem(a,function(a){var b=a.cloneNode();b.removeAttribute("bind."),b.removeAttribute("data-bind."),b.setAttribute("bind.",f+"."+d+" as "+e+(g.length>0?";"+g:"")),b.style.display="",a.parentNode.insertBefore(b,a),$cheeta.compiler.recursiveCompile(this.__parentModels,b,!0)})}}})},$cheeta.templates={},$cheeta.directives.template=function(a,b,c){b.innerHTML=$cheeta.templates[a]||b.innerHTML;for(var d=b.childNodes,e=0;e<d.length;e++)$cheeta.compiler.recursiveCompile(c,d[e])};