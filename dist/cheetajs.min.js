/*! cheetajs 2013-12-18 */
if(!$cheeta){var $cheeta=$cheeta||function(a){var b=[a];return b.on=function(b,c){for(var d=b.split(" "),e=0;e<d.length;e++)d[e].length>0&&a.addEventListener(d[e],c,!1)},b.off=function(b,c){for(var d=b.split(" "),e=0;e<d.length;e++)d[e].length>0&&a.removeEventListener(d[e],c,!1)},b};window.$cheeta=window.Oo=$cheeta}$cheeta.model=$cheeta.model||{Model:function(a,b){this.value=void 0,this.bindings={},this.parent=a,this.names=[b],this.children={},this.toExpr=function(){for(var a="",b=this;null!=b.parent&&null!=b.names[0];){var c=b.names[0].charAt(0);a=(c>="0"&&"9">=c?"["+b.names[0]+"]":"."+b.names[0])+a,b=b.parent}return a.substring(1)},this.createOrGetChild=function(a){var b=this.children[a];return void 0===b&&(b=new $cheeta.model.Model(this,a),$cheeta.model.interceptProp(b,this.value,a),this.children[a]=b,b.value=null==this.value?void 0:this.value[a]),null==this.value&&(this.value=this.isArray?[]:{}),b},this.bind=function(a,b,c,d){return console.log("model bind: ",a,b,c),c!=this.names[0]&&this.names.push(c),d&&(this.bindings[a]||(this.bindings[a]={}),this.bindings[a][b]=d,null!=this.value&&($cheeta.future.evals[0][a]=$cheeta.future.evals[0][a]||{},$cheeta.future.evals[0][a][b]=d)),this},this.unbind=function(a,b){return console.log("model unbind: ",a,attr),this.bindings[a]&&delete this.bindings[a][b],this},this.valueChange=function(a,b){if(a!=b)for(var c in this.bindings)for(var d in this.bindings[c])this.bindings[c][d].onChange(a,b);return this},this.addDirective=function(a){null==this.directives&&(this.directives={}),this.directives[a.name]=a,a.isGlobal()&&(null==this.directives["/"]&&(this.directives["/"]=[]),this.directives["/"].push(a.name.length-1))},this.getDirective=function(a){return null==this.directives?null:this.directives[a]}},ArrayInterceptor:function(a){return{push:function(){var b=this.length,c=Array.prototype.push.apply(this,arguments),d=this.length;return a.valueChange(d,b),c},pop:function(){var b=this.length,c=Array.prototype.pop.apply(this,arguments),d=this.length;return a.valueChange(d,b),c},shift:function(){return this.splice(0,1)[0]},unshift:function(){var a=[].slice.apply(arguments);return a.unshift(0,0),this.splice.apply(this,a),this.length},splice:function(){var b=this.length,c=Array.prototype.splice.apply(this,arguments),d=this.length;return a.valueChange(d,b),c}}},interceptArray:function(a){if(null!=a.value){var b=new this.ArrayInterceptor(a);for(var c in b){if(a.value[c]==b[c])break;a.value[c]=b[c]}}},interceptProp:function(a,b,c){if(console.log("intercepting: ",b,c),null!=b){var d=b[c],e=a.parent.children&&null!=a.parent.children[c],f=e?null:Object.getOwnPropertyDescriptor(b,c);try{Object.defineProperty(b,c,{set:function(c){f&&f.set&&f.set.apply(b,arguments),c=f&&f.get&&f.get.apply(b)||c;var d=a.value;if(d!=c&&(a.value=c,a.isArray&&$cheeta.model.interceptArray(a),a.valueChange(c,d),c instanceof Object))for(var e in a.children){var g=c[e];$cheeta.model.interceptProp(a.children[e],c,e),c[e]=g}},get:function(){return f&&f.get&&f.get.apply(b)||a.value},enumerable:!0,configurable:!0})}catch(g){if(!(g instanceof TypeError))throw g;return}b[c]=d}},findParentModel:function(a,b){for(;a!=$cheeta.model.root;){if(a.names.indexOf(b)>-1)return a;a=a.parent}return a},createOrGetModel:function(a,b){if(null==a&&(a=[$cheeta.model.root]),"$i"==b)for(var c=a.length-1;c>=0;c--)if("$i"==a[c].name)return a[c];"."===b.charAt(0)&&(b=a[0].names[0]+b);var d=b.split(/\./g);b=d[d.length-1];for(var e=d[0],f=$cheeta.model.root,g=0;g<a.length&&(f=a[g],f=this.findParentModel(f,e),f==$cheeta.model.root);g++);if(1==d.length&&f!==$cheeta.model.root)b=f.name,f=f.parent;else for(var c=f===$cheeta.model.root?0:1;c<d.length-1;c++)f=f.children[d[c]]||f.createOrGetChild(d[c]);return f.createOrGetChild(b)}},$cheeta.model.root=$cheeta.model.root||new $cheeta.model.Model(null),$cheeta.model.root.value=window,$cheeta.root=$cheeta.model.root,window.addEventListener("load",function(){$cheeta.isInitialized||($cheeta.isInitialized=!0,$cheeta.future={evals:[{}]},$cheeta.hash.init(),$cheeta.compiler.compile([$cheeta.model.root],document.documentElement))},!1),$cheeta.Directive=function(name){this.name=name,this.isGlobal=function(){return this.name.indexOf("*",this.name.length-1)>-1},this.order=1e3,this.setOrder=function(a){return this.order=a,this},this.onBind=function(a){return null!=a?(this.bindFn=a,this):this.bindFn},this.bind=function(a,b){return console.log("directive bind ",a,b),this.bindFn?this.bindFn.apply(this,arguments):null},this.onUnbind=function(a){return null!=a?(this.unbindFn=a,this):this.unbindFn},this.unbind=function(a,b,c){var d=this.unbindFn&&this.unbindFn.apply(this,arguments)||[];this.resolveModelNames(a,b,c,function(c){console.log("directive unbind: ",a,b),d.push(c),c.unbind(a,b)},!0)},this.resolveModelNames=function(a,b,c,d,e){var f="",g=[];return this.tokenizeAttrVal(a.getAttribute(b),{onVar:function(a){var b=$cheeta.model.createOrGetModel(c,a);g.push(b),f+=b.toExpr(),d&&d(b)},onLiteral:function(a){f+=a}}),e||a.setAttribute(b,f),f},this.tokenizeAttrVal=function(a,b){var c=null,d=!1,e=-1;a+="";for(var f=0;f<a.length;f++){var g=a.charAt(f);if(null!=c)g==c&&"\\"!=a.charAt(f-1)&&("/"==c&&(d=!0),c=null),b.onLiteral(g);else if(d)"a">g&&g>"z"&&(d=!1),b.onLiteral(g);else if(" "===g||"	"===g||"\r"===g||"\n"===g||"!"===g||'"'===g||"["===g||"]"===g||g>="%"&&"/">=g&&"."!=g||g>=":"&&"?">=g||g>="{"&&"~">=g||"^"===g||""==g){if(("'"===g||'"'===g||"/"===g)&&(c=g),e>-1){var h=a.substring(e,f);if("true"!==h&&"false"!==h&&"undefined"!==h&&"null"!==h&&"NaN"!==h&&isNaN(h)){for(var i=f;" "==a.charAt(i);)i++;if("("==a.charAt(i)){var j=h.lastIndexOf(".");j>-1?(b.onVar(h.substring(0,j)),b.onLiteral(h.substring(j))):b.onLiteral(h)}else b.onVar(h)}else b.onLiteral(h);e=-1}""!==g&&b.onLiteral(g)}else-1==e&&(e=f)}},this.onValueChange=function(fn){var origBind=this.bindFn;return this.bindFn=function(elem,attrName,parentModels){origBind&&origBind(),this.resolveModelNames(elem,attrName,parentModels,function(model){model.bind(elem,attrName,null,function(elem,attrName){var val=eval(elem.getAttribute(attrName));fn.apply(this,[val,elem,attrName,parentModels])})})},this}},$cheeta.directive={add:function(a){$cheeta.root.addDirective(a)},get:function(a,b){0==a.indexOf("data-")&&(a=a.substring(5));var c=a.indexOf(".",a.length-1)>-1,d=[];b=b||[$cheeta.model.root];for(var e=0;e<b.length;e++){var f=b[e],g=f.getDirective(a);if(null==g&&null!=f.directives&&null!=f.directives["/"]&&c)for(var h=f.directives["/"],i=0;i<h.length;i++)g=f.directives[a.substring(0,h[i])+"*"],null!=g&&d.push(g);else null!=g&&d.push(g)}return 0==d.length?$cheeta.directive.get(""):d}},$cheeta.compiler={recursiveCompile:function(a,b,c,d,e,f){if(b){var g=a;if(!f&&1===b.nodeType){if("script"==b.tagName.toLowerCase()&&!d){var h=b;if(!c||null!=h.parentNode&&"head"==h.parentNode.tagName.toLowerCase()||null!=h.type&&""!=h.type&&"text/javascript"!==h.type)"text/cheeta-template"===h.type&&($cheeta.templates[h.getAttribute("id")]=h.innerHTML||"");else{var i=h.innerHTML||"",j=document.getElementsByTagName("head")[0]||document.documentElement;h=document.createElement("script"),h.type="text/javascript",h.appendChild(document.createTextNode(i)),j.insertBefore(h,j.firstChild),j.removeChild(h)}}g=this.compileDirectives(a,b,d)}b.__isFor_?b.__isFor_=void 0:this.recursiveCompile(g,b.firstChild,c,d),e||this.recursiveCompile(a,b.nextSibling,c,d)}},doCompile:function(){this.recursiveCompile.apply(this,arguments),this.runFutures()},compile:function(a,b,c){this.doCompile(a,b,c,!1,!0)},compileChildren:function(a,b,c){this.doCompile(a,b,c,!1,!0,!0)},uncompile:function(a,b){this.doCompile(a,b,!1,!0,!0)},uncompileChildren:function(a,b){this.doCompile(a,b,!1,!0,!0,!0)},compileDirectives:function(a,b,c){for(var d=this.getAttrDirectives(b,c,a),e=0;e<d.length;e++){var f,g=d[e];if(f=c?g.directive.unbind(b,g.attrName,a):g.directive.bind(b,g.attrName,a),a=(f||[]).concat(a),b.__isFor_)break}return a},getAttrDirectives:function(a,b,c){function d(a){for(var b=$cheeta.directive.get(a.name,c),d=0;d<b.length;d++){var f,g={attrName:a.name,directive:b[d]};for(f=e.length-1;f>=0&&!(g.directive.order>e[f].directive.order);f--);e.splice(f+1,0,g)}}for(var e=[],f=[],g=0;g<a.attributes.length;g++){var h=a.attributes[g];if(h.specified){var i=h.name.split(".");if(""!=i[i.length-1])continue;if(i.pop(),i.length>1)for(var j=0;j<i.length;j++)f.push({name:i[j]+".",value:h.value});else d(h)}}for(;f.length;){var h=f.pop();null==a.getAttribute(h.name)&&a.setAttribute(h.name,h.value),d(a.attributes[h.name])}return e},runFutures:function(){var runs=$cheeta.future.evals.slice(0);$cheeta.future.evals=[{}];for(var elem in runs[0])for(var attrName in runs[0][elem])console.log("onchange ",elem,attrName),runs[0][elem][attrName](elem,attrName);for(var i=0;i<runs.length;i++){var expr=runs[i];expr instanceof Function?expr():eval(expr)}}},$cheeta.XHR=function(){var a=this.send,b=this.open,c=new XMLHttpRequest;c.open=function(){return b.apply(c,arguments),c},c.send=function(){return a.apply(c,arguments),c};var d=[],e=[],f=[],g=[];return c.onError=function(a){return f.push(a),c},c.onSuccess=function(a){return d.push(a),c},c.onComplete=function(a){return e.push(a),c},c.onStateChange=function(a){g.push(a)},c.onreadystatechange=function(){if(4==c.readyState){if(200<=c.status&&c.status<300)for(var a=0;a<d.length;a++)d[a].apply(c,[c]);else for(var a=0;a<f.length;a++)f[a].apply(c,[c]);for(var a=0;a<e.length;a++)e[a].apply(c,[c])}for(var a=0;a<g.length;a++)g[a].apply(c,[c])},Object.defineProperty(c,"data",{get:function(){return"application/json"==c.getResponseHeader("Content-Type")?JSON.stringify(c.responseText):c.responseText},enumerable:!0,configurable:!0}),c},$cheeta.XHR.prototype=new XMLHttpRequest,function(){$cheeta.root.addDirective(new $cheeta.Directive("bind.").onBind(function(elem,attrName,parentModels){this.fn=this.fn||{},this.fn[elem]=function(e){setTimeout(function(){eval(elem.getAttribute(attrName)+"='"+elem.value.replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'")},0)},$cheeta.directive.get("value.")[0].bind(elem,attrName,parentModels),$cheeta(elem).on("keydown keyup change",this.fn[elem])}).onUnbind(function(a){this.fn[a]&&$cheeta(a).off("keydown keyup change",this.fn[a])}).setOrder(800))}(),function(){var a=function(a,b,c){for(var d=a.getAttribute(b).split(/ *; */g),e=[],f=0;f<d.length;f++){var g=d[f];split=g.split(/ +as +/g);var h=split[0],i=split.length>1?split[1]:null,j={elem:a,attrName:"ctrl",as:i};e.push($cheeta.model.createOrGetModel(c,h).bind(j))}return e};$cheeta.directive.add(new $cheeta.Directive("ctrl.").setOrder(200).onBind(a)),$cheeta.directive.add(new $cheeta.Directive("model.").setOrder(200).onBind(a))}(),$cheeta.directive.add(new $cheeta.Directive("").onValueChange(function(a,b,c){var d=c.substring(0==c.indexOf("data-")?5:0,c.length-1);b.setAttribute(d,a)})),$cheeta.directive.add(new $cheeta.Directive("for.").setOrder(100).onBind(function(a,b,c){a.__isFor_=!0;var d,e,f,g=a.getAttribute(b).split(/ +in +/g);d=g[1],e=g[0],g=d.split(/ +as +/g),d=g[0],f=g.length>1?g[1]:null;var h={elem:a,arrayVar:e,arrayName:d,as:f,onChange:function(a,b){if((a instanceof Object||b instanceof Object)&&(a=null==a?0:a.length,b=null==b?0:b.length),b>a)for(var c=b-1;c>=a;c--){for(var d in i.children[c].bindings)for(var e=i.children[c].bindings[d],f=0;f<e.length;f++){var g=e[f].elem;g.parentNode.removeChild(g)}delete i.children[c]}else if(a>b)for(var h=this.arrayVar,j=this.arrayName,c=b;a>c;c++){var k=this.elem.cloneNode();k.removeAttribute("for."),k.removeAttribute("data-for."),k.setAttribute("model.",j+"."+c+" as "+h+(this.elem.getAttribute("model.")?";"+this.elem.getAttribute("model.").value:"")),k.style.display="",this.elem.parentNode.insertBefore(k,this.elem);var l=new $cheeta.model.Model($cheeta.model.root,"$i");l.toExpr=function(){return c},$cheeta.compiler.compile(this.parentModels.concat(l),k)}}},i=$cheeta.model.createOrGetModel(c,d).bind(h);return h.parentModels=c,a.style.display="none",i.isArray=!0,[i]})),$cheeta.directive.add(new $cheeta.Directive("html.").onValueChange(function(a,b){a!=b.innerHTML&&(b.innerHTML=a||"")})),$cheeta.directive.add(new $cheeta.Directive("init.").onBind(function(a,b,c){var d=this.resolveModelNames(a,b,c);$cheeta.future.evals.push(d)})),$cheeta.keyconsts={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,space:32,pause:19,"break":19,capslock:20,escape:27,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,"down arrow":40,insert:45,"delete":46,colon:58,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,semicolon:186,comma:188,dash:189,dot:190},$cheeta.directive.add(new $cheeta.Directive("on*").onBind(function(elem,attrName,parentModels){this.listeners=[];var _listeners=this.listeners;this.resolveModelNames(elem,attrName,parentModels);var baseAttrName=attrName.substring(0==attrName.indexOf("data-")?7:2,attrName.length-1),split=baseAttrName.split("-");!function bindEvent(event,key,attrName){var fn=function(e){eval(elem.getAttribute(attrName))};if(0==event.indexOf("key")){var keyFn=function(a){var b=1;if(1==key.length)b=key.charCodeAt(0);else if(b=$cheeta.keyconsts[key],null==b&&(b=parseInt(key),isNaN(b)))throw"unknown key: "+key;a.which==b&&fn.apply(elem,[a])};_listeners.push({event:event,fn:keyFn}),elem.addEventListener(event,keyFn,!1)}else{var listenerFn=function(a){fn.apply(elem,[a])};_listeners.push({event:event,fn:listenerFn}),elem.addEventListener(event,listenerFn,!1)}}(split[0],split[1],attrName)}).onUnbind(function(a){for(var b=0;b<this.listeners;b++){var c=this.listener[b];a.removeEventListener(c.event,c.fn,!1)}})),$cheeta.directive.add(new $cheeta.Directive("text.").onValueChange(function(a,b){b.innerHTML="",b.appendChild(document.createTextNode(a||"")),console.log("innerhtml after: "+b.innerHTML)})),$cheeta.directive.add(new $cheeta.Directive("value.").onValueChange(function(a,b){b.value!=a&&(b.value=a||null)})),function(){$cheeta.templates=$cheeta.templates||{};var a=new $cheeta.Directive("view.").onValueChange(function(b,c,d,e){if(!c.__$cheeta_view_is_loading&&null!=b){c.__$cheeta_view_is_loading=!0;try{var f=$cheeta.templates[b];if(null!=f)a.loadView(c,f,e);else{var g=0===b.indexOf("/")?a.baseURL+b:b;null!=a.cache[g]?a.loadView(c,a.cache[g],e):(new $cheeta.XHR).open("get",g).onSuccess(function(b){a.cache[g]=b.data,a.loadView(c,b.data,e)}).send()}}finally{c.__$cheeta_view_is_loading=!1}}}).setOrder(900);a.baseURL=window.location.protocol+"//"+window.location.hostname+(window.location.port&&":"+window.location.port)+window.location.pathname,a.loadView=function(a,b,c){$cheeta.compiler.uncompileChildren(c,a),a.innerHTML=b,$cheeta.compiler.compileChildren(c,a,!0)},a.cache={},$cheeta.directive.add(a)}(),$cheeta.hash={keyval:{},watchers:{},watch:function(a,b){a instanceof Function&&(b=a,a=""),null==this.watchers[a]&&(this.watchers[a]=[]),-1===this.watchers[a].indexOf(b)&&this.watchers[a].push(b)},unwatch:function(a,b){b instanceof Function&&(a=b,b="");var c=this.watchers[b];if(null!=c){var d=c.indexOf(a);d>-1&&c.splice(d,1)}},notify:function(a,b,c){var d=this.watchers[a];if(null!=d)for(var e=0;e<d.length;e++)d[e](b,c)},set:function(a,b){void 0==b&&(b=a,a="");var c=this.keyval[a];this.keyval[a]=b;var d=function(){var a=this.keyval[""]||"";for(var b in this.keyval)b.length>0&&(a+=(a.length>0?"&":"")+b+"="+this.keyval[b]);return a};window.location.hash=d(),this.notify(a,b,c)},init:function(){var a=this;window.addEventListener("hashchange",function(){var b,c=window.location.hash,d=0,e="",f={};try{c=c.substring(c.length>1&&"&"==c.charAt(2)?2:1);for(var g=0;g<=c.length;g++)if("&"==c.charAt(g)||g==c.length){if(b=c.substring(d,g),null==a.keyval[e]||a.keyval[e]!=b){var h=a.keyval[e];a.keyval[e]=b,a.notify(e,b,h)}d=g+1,f[e]=!0,e=""}else"="==c.charAt(g)&&(e=c.substring(d,g),d=g+1);for(var e in a.keyval)if(null==f[e]){var h=a.keyval[e];delete a.keyval[e],a.notify(e,null,h)}}finally{a.value=c}},!1)},get value(){return window.location.hash.length>0?window.location.hash.substring(1):window.location.hash},set value(a){return window.location.hash="#"+a}},$cheeta.route=$cheeta.route||function(a,b){if(null==a)return null;var c=0,d=null;for(var e in a)0==b.indexOf(e)&&c<e.length&&(c=e.length,d=a[e]);return d};