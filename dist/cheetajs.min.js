/*! cheetajs 2013-12-10 */
if(!$cheeta){var $cheeta=$cheeta||{};window.$cheeta=$cheeta}$cheeta.model=$cheeta.model||{Model:function(a,b){this.value=void 0,this.bindings={},this.parent=a,this.name=b,this.children={},this.toExpr=function(){for(var a="",b=this;null!=b.parent&&null!=b.name;){var c=b.name.charAt(0);a=(c>="0"&&"9">=c?"["+b.name+"]":"."+b.name)+a,b=b.parent}return a.substring(1)}},ArrayInterceptor:function(a){return{push:function(){var b=this.length,c=Array.prototype.push.apply(this,arguments),d=this.length;return $cheeta.model.update(a,d,b),c},pop:function(){var b=this.length,c=Array.prototype.pop.apply(this,arguments),d=this.length;return $cheeta.model.update(a,d,b),c},shift:function(){var b=this.length,c=Array.prototype.shift.apply(this,arguments);a.parent.value[a.name]=this;var d=this.length;return $cheeta.model.update(a,d,b),c},unshift:function(){var b=this.length,c=Array.prototype.unshift.apply(this,arguments);a.parent.value[a.name]=this;var d=this.length;return $cheeta.model.update(a,d,b),c},splice:function(){var b=this.length,c=Array.prototype.splice.apply(this,arguments),d=this.length;return $cheeta.model.update(a,d,b),c}}},interceptArray:function(a){if(null!=a.value){var b=new this.ArrayInterceptor(a);for(var c in b){if(a.value[c]==b[c])break;a.value[c]=b[c]}}},update:function(a,b,c){for(var d in a.bindings)for(var e=a.bindings[d],f=0;f<e.length;f++){var g=e[f];g.update&&g.update(b,c)}},bindElement:function(a,b,c){console.log("bind element: ",a,b,c);var d=a.children[b];if(void 0===d&&(d=new $cheeta.model.Model,d.name=b,d.parent=a,this.interceptProp(d,a.value,b),a.children[b]=d),null!=c){var e=c.as||b;null==d.bindings[e]&&(d.bindings[e]=[]),d.bindings[e].push(c)}return d.value=void 0==a.value?void 0:null==a.value?null:a.value[b],d},interceptProp:function(a,b,c){if(console.log("intercepting: ",b,c),null!=b){var d=b[c];try{Object.defineProperty(b,c,{set:function(b){var c=a.value;if(c!=b&&(a.value=b,a.isArray&&$cheeta.model.interceptArray(a)),$cheeta.model.update(a,b,c),b instanceof Object)for(var d in a.children){var e=b[d];$cheeta.model.interceptProp(a.children[d],b,d),b[d]=e}},get:function(){return a.value},enumerable:!0,configurable:!0})}catch(e){if(!(e instanceof TypeError))throw e;return}b[c]=d,$cheeta.future.evals.push(function(){null!=b&&(b[c]=d)})}},findParentModel:function(a,b){for(;a!=$cheeta.model.root;){if(b==a.name||a.bindings&&null!=a.bindings[b])return a;a=a.parent}return a},bind:function(a,b,c){if("$i"==b)for(var d=a.length-1;d>=0;d--)if("$i"==a[d].name)return a[d];if("."===b.charAt(0))for(key in a[0].bindings){b=key+b;break}null==a&&(a=[$cheeta.model.root]);var e=b.split(/\./g);b=e[e.length-1];for(var f=e[0],g=$cheeta.model.root,h=0;h<a.length&&(g=a[h],g=this.findParentModel(g,f),g==$cheeta.model.root);h++);if(1==e.length&&g!==$cheeta.model.root)b=g.name,g=g.parent;else for(var d=g===$cheeta.model.root?0:1;d<e.length-1;d++){if(null==g.children[e[d]]&&null==this.bindElement(g,e[d],null==c?null:{elem:c.elem,attrName:"bind."}))return null;g=g.children[e[d]]}return this.bindElement(g,b,c)}},$cheeta.model.root=$cheeta.model.root||new $cheeta.model.Model(null),$cheeta.model.root.value=window,$cheeta.on=function(a,b,c){for(var d=a.split(" "),e=0;e<d.length;e++)d[e].length>0&&b.addEventListener(d[e],c,!1)},window.addEventListener("load",function(){$cheeta.isInitialized||($cheeta.isInitialized=!0,$cheeta.future={evals:[]},$cheeta.location.init(),$cheeta.compiler.compile([],document.documentElement))},!1),$cheeta.directive={get:function(a,b){0==a.indexOf("data-")&&(a=a.substring(5));var c=a.indexOf(".",a.length-1)>-1,d=[];b=b||[$cheeta.model.root];for(var e=0;e<b.length;e++){var f=b[e],g=f.directives&&f.directives[a];if(null==g&&null!=f.directives["/"]&&c)for(var h=f.directives["/"],i=0;i<h.length;i++)g=f.directives[a.substring(0,h[i])+"*"],null!=g&&d.push(g);else null!=g&&d.push(g)}return 0==d.length?$cheeta.directive.get(""):d},define:function(a,b){var c=$cheeta.model.root;null!=b&&(c=$cheeta.model.bind([c],b)),a.order=a.order||1e3,null==c.directives&&(c.directives=[]),c.directives[a.name]=a,a.name.indexOf("*",a.name.length-1)>-1&&(null==c.directives["/"]&&(c.directives["/"]=[]),c.directives["/"].push(a.name.length-1))},resolveModelRefs:function(a,b,c,d){for(var e=function(e){var f=null==d?null:{elem:a,attrName:b,baseAttrName:b.substring(0==b.indexOf("data-")?5:0,b.length-1),update:function(){d.apply(this,[g])}},g=$cheeta.model.bind(c,e,f);return null!=g?g.toExpr():e},f=null,g=!1,h="",i=-1,j=a.getAttribute(b)+"",k=0;k<j.length;k++){var l=j.charAt(k);if(null!=f)l==f&&"\\"!=j.charAt(k-1)&&("/"==f&&(g=!0),f=null),h+=l;else if(g)"a">l&&l>"z"&&(g=!1),h+=l;else if(" "==l||"	"==l||"\r"==l||"\n"==l||"!"==l||'"'==l||l>="%"&&"/">=l&&"."!=l||l>=":"&&"?">=l||""==l){if(("'"==l||'"'==l||"/"==l)&&(f=l),i>-1){var m=j.substring(i,k);if("true"!==m&&"false"!==m&&"undefined"!==m&&"null"!==m&&"NaN"!==m&&isNaN(m)){for(var n=k;" "==j.charAt(n);)n++;if("("==j.charAt(n)){var o=m.lastIndexOf(".");o>-1?(h+=e(m.substring(0,o))+".",h+=m.substring(o+1)):h+=m}else h+=e(m)}else h+=m;i=-1}h+=l}else-1==i&&(i=k)}return h.substring(0,h.length-1)},onModelUpdate:function(elem,attrName,parentModels,fn){var expr=$cheeta.directive.resolveModelRefs(elem,attrName,parentModels,function(model){var val=null;try{val=eval(elem.getAttribute(this.attrName))}catch(e){}fn.apply(this,[val])});elem.setAttribute(attrName,expr)}},$cheeta.compiler={recursiveCompile:function(a,b,c,d,e){if(b){var f=a;if(1===b.nodeType){if("script"==b.tagName.toLowerCase()&&!d){var g=b;if(!c||null!=g.parentNode&&"head"==g.parentNode.tagName.toLowerCase()||null!=g.type&&""!=g.type&&"text/javascript"!==g.type)"text/cheeta-template"===g.type&&($cheeta.templates[g.getAttribute("id")]=g.innerHTML||"");else{var h=g.innerHTML||"",i=document.getElementsByTagName("head")[0]||document.documentElement;g=document.createElement("script"),g.type="text/javascript",g.appendChild(document.createTextNode(h)),i.insertBefore(g,i.firstChild),i.removeChild(g)}}f=d?(this.cleanUpBindings(b)||[]).concat(a):this.compileDirectives(a,b,d)}b.__isFor_?b.__isFor_=void 0:this.recursiveCompile(f,b.firstChild,c,d),e||this.recursiveCompile(a,b.nextSibling,c,d)}},compile:function(a,b,c){$cheeta.future.evals=[],this.recursiveCompile(a,b,c,!1,!0),this.runFutures()},uncompile:function(a,b){$cheeta.future.evals=[],this.recursiveCompile(a,b,!1,!0,!0),this.runFutures()},cleanUpBindings:function(a){if(null!=a.__$cheeta_models_){for(var b=0;b<a.__$cheeta_models_.length;b++){var c=a.__$cheeta_models_[b];for(var d in c.bindings)for(var e=c.bindings[d],f=0;f<e.length;f++){var g=e[f];g.elem==a&&e.splice(f,1)}}return a.__$cheeta_models_}},compileDirectives:function(a,b){function c(a){for(var b={name:a+".",directives:$cheeta.directive.get(a)},c=d.length-1;c>=0;c--)b.order>d[c].directive.order&&d.splice(c+1,0,b)}for(var d=[],e=[],f=0;f<b.attributes.length;f++){var g=b.attributes[f];if(g.specified){var h=g.name.split(".");if(""!=h[h.length-1])continue;if(h.pop(),h.length>1)for(var i=0;i<h.length-1;i++)c(h[i]+"."),e.push({name:h[i]+".",value:g.value});else c(g.name)}}for(;e.length;){var g=e.pop();b.setAttribute(g.name,g.value)}for(var f=0;f<d.length;f++){var j=d[f];if(null!=j.directives)for(var i=0;i<j.directives.length;i++){var k=j.directives[i],l=k.bind(b,k.name,a);a=(l||[]).concat(a)}if(b.__isFor_)break}return b.__$cheeta_models_=a,a},runFutures:function(){for(var i=0;i<$cheeta.future.evals.length;i++){var expr=$cheeta.future.evals[i];expr instanceof Function?expr():eval(expr)}}},$cheeta.XHR=function(){var a=this.send,b=this.open,c=new XMLHttpRequest;c.open=function(){return b.apply(c,arguments),c},c.send=function(){return a.apply(c,arguments),c};var d=[],e=[],f=[],g=[];return c.onError=function(a){return f.push(a),c},c.onSuccess=function(a){return d.push(a),c},c.onComplete=function(a){return e.push(a),c},c.onStateChange=function(a){g.push(a)},c.onreadystatechange=function(){if(4==c.readyState){if(200<=c.status&&c.status<300)for(var a=0;a<d.length;a++)d[a].apply(c,[c]);else for(var a=0;a<f.length;a++)f[a].apply(c,[c]);for(var a=0;a<e.length;a++)e[a].apply(c,[c])}for(var a=0;a<g.length;a++)g[a].apply(c,[c])},Object.defineProperty(c,"data",{get:function(){return"application/json"==c.getResponseHeader("Content-Type")?JSON.stringify(c.responseText):c.responseText},enumerable:!0,configurable:!0}),c},$cheeta.XHR.prototype=new XMLHttpRequest,$cheeta.directive.define({name:"bind.",bind:function(elem,attrName,parentModels){$cheeta.directive.get("value.")[0].bind(elem,attrName,parentModels),$cheeta.on("keydown keyup change",elem,function(e){setTimeout(function(){eval(elem.getAttribute(attrName)+"='"+elem.value.replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'")},0)})},order:800}),function(){var a=function(a,b,c){for(var d=a.getAttribute(b).split(/ *; */g),e=[],f=0;f<d.length;f++){var g=d[f];split=g.split(/ +as +/g);var h=split[0],i=split.length>1?split[1]:null,j={elem:a,attrName:"ctrl",as:i};e.push($cheeta.model.bind(c,h,j))}return e};$cheeta.directive.define({name:"ctrl.",bind:a,order:200}),$cheeta.directive.define({name:"model.",bind:a,order:200})}(),$cheeta.directive.define({name:"",bind:function(a,b,c){$cheeta.directive.onModelUpdate(a,b,c,function(b){a.setAttribute(this.baseAttrName,b)})},order:700}),$cheeta.directive.define({name:"for.",order:100,bind:function(a,b,c){a.__isFor_=!0;var d,e,f,g=a.getAttribute(b).split(/ +in +/g);d=g[1],e=g[0],g=d.split(/ +as +/g),d=g[0],f=g.length>1?g[1]:null;var h={elem:a,arrayVar:e,arrayName:d,as:f,update:function(a,b){if((a instanceof Object||b instanceof Object)&&(a=null==a?0:a.length,b=null==b?0:b.length),b>a)for(var c=b-1;c>=a;c--){for(var d in i.children[c].bindings)for(var e=i.children[c].bindings[d],f=0;f<e.length;f++){var g=e[f].elem;g.parentNode.removeChild(g)}delete i.children[c]}else if(a>b)for(var h=this.arrayVar,j=this.arrayName,c=b;a>c;c++){var k=this.elem.cloneNode();k.removeAttribute("for."),k.removeAttribute("data-for."),k.setAttribute("model.",j+"."+c+" as "+h+(this.elem.getAttribute("model.")?";"+this.elem.getAttribute("model.").value:"")),k.style.display="",this.elem.parentNode.insertBefore(k,this.elem);var l=new $cheeta.model.Model($cheeta.model.root,"$i");l.toExpr=function(){return c},$cheeta.compiler.compile(this.parentModels.concat(l),k)}}},i=$cheeta.model.bind(c,d,h);return h.parentModels=c,a.style.display="none",i.isArray=!0,[i]},unbind:function(){}}),$cheeta.directive.define({name:"html.",bind:function(a,b,c){$cheeta.directive.onModelUpdate(a,b,c,function(b){b!=a.innerHTML&&(a.innerHTML=b||"")})},order:600}),$cheeta.directive.define({name:"init.",bind:function(a,b,c){var d=$cheeta.directive.resolveModelRefs(a,b,c);$cheeta.future.evals.push(d)},order:700}),$cheeta.keyconsts={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,space:32,pause:19,"break":19,capslock:20,escape:27,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,"down arrow":40,insert:45,"delete":46,colon:58,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,semicolon:186,comma:188,dash:189,dot:190},$cheeta.directive.define({name:"on*",bind:function(elem,attrName,parentModels){var expr=$cheeta.directive.resolveModelRefs(elem.getAttribute(attrName),attrName,parentModels);elem.setAttribute(attrName,expr);var baseAttrName=attrName.substring(0==attrName.indexOf("data-")?7:2,attrName.length-1),split=baseAttrName.split("-");!function bindEvent(event,key,attrName){var fn=function(e){eval(elem.getAttribute(attrName))};0==event.indexOf("key")?elem.addEventListener(event,function(a){var b=1;if(1==key.length)b=key.charCodeAt(0);else if(b=$cheeta.keyconsts[key],null==b&&(b=parseInt(key),isNaN(b)))throw"unknown key: "+key;a.which==b&&fn.apply(elem,[a])},!1):elem.addEventListener(event,function(a){fn.apply(elem,[a])},!1)}(split[0],split[1],attrName)},order:800}),$cheeta.directive.define({name:"route.",bind:function(a,b,c){var d=this;$cheeta.directive.onModelUpdate(a,b,c,function(b){null!=d.watchFn&&$cheeta.location.unwatch(d.fn),d.watchFn=$cheeta.location.watch(function(d){var e=0,f=null;for(var g in b)0==d.indexOf(g)&&e<g.length&&(e=g.length,f=b[g]);null!=f&&$cheeta.directive.get("template.")[0].bind(a,{name:"template.",value:f},c)})})},order:900}),$cheeta.templates={},$cheeta.directive.define({name:"template.",bind:function(a,b,c){var d=window.location.protocol+"//"+window.location.hostname+(window.location.port&&":"+window.location.port)+window.location.pathname;this.loadTemplate=function(a,b){$cheeta.compiler.uncompile(c,a),a.innerHTML=b,$cheeta.compiler.compile(c,a,!0)};var e=this.loadTemplate,f=a.getAttribute(b),g=$cheeta.templates[f];null!=g?e(a,g):(new $cheeta.XHR).open("get",0===f.indexOf("/")?d+f:f).onSuccess(function(b){e(a,b.data)}).send()},order:900}),$cheeta.directive.define({name:"text.",bind:function(a,b,c){$cheeta.directive.onModelUpdate(a,b,c,function(b){a.innerHTML="",a.appendChild(document.createTextNode(b||"")),console.log("innerhtml after: "+a.innerHTML)})},order:600}),$cheeta.directive.define({name:"value.",bind:function(a,b,c){$cheeta.directive.onModelUpdate(a,b,c,function(b){a.value!=b&&(a.value=b||null)})},order:600}),$cheeta.location={keyval:{},watchers:{},watch:function(a,b){a instanceof Function&&(b=a,a=""),null==this.watchers[a]&&(this.watchers[a]=[]),this.watchers[a].push(b)},unwatch:function(a,b){b instanceof Function&&(a=b,b="");var c=this.watchers[b];if(null!=c){var d=c.indexOf(a);d>-1&&c.splice(d,1)}},notify:function(a,b,c){var d=this.watchers[a];if(null!=d)for(var e=0;e<d.length;e++)d[e](b,c)},set:function(a,b){void 0==b&&(b=a,a="");var c=this.keyval[a];this.keyval[a]=b,window.location.hash=this.toHash(),this.notify(a,b,c)},toHash:function(){var a=this.keyval[""]||"";for(var b in this.keyval)b.length>0&&(a+=(a.length>0?"&":"")+b+"="+this.keyval[b]);return a},init:function(){var a=this;window.addEventListener("hashchange",function(){var b,c=window.location.hash,d=0,e="",f={};c=c.substring(c.length>1&&"&"==c.charAt(2)?2:1);for(var g=0;g<=c.length;g++)if("&"==c.charAt(g)||g==c.length){if(b=c.substring(d,g),null==a.keyval[e]||a.keyval[e]!=b){var h=a.keyval[e];a.keyval[e]=b,a.notify(e,b,h)}d=g+1,f[e]=!0,e=""}else"="==c.charAt(g)&&(e=c.substring(d,g),d=g+1);for(var e in a.keyval)if(null==f[e]){var h=a.keyval[e];delete a.keyval[e],a.notify(e,null,h)}},!1),null==document.body.getAttribute("route.")&&(document.body.setAttribute("route.","$cheeta.location.routes"),$cheeta.directive.get("route.")[0].bind(document.body,"route.",[]))},routes:{}};