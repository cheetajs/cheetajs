/*! cheetajs 2013-12-05 */
var $cheeta={};window.$cheeta=$cheeta,$cheeta.model={Model:function(a,b){this.__value=void 0,this.__bindings={},this.__parent=a,this.__name=b},ArrayInterceptor:function(){var a=[].push,b=[].pop,c=[].splice,d=function(a,b,c){for(var d=0;d<a.__cheetaUpdateInterceptors_.length;d++)a.__cheetaUpdateInterceptors_[d].apply(a,[b,c])};return{push:function(){this.updates=[];var b=this.length,c=a.apply(this,arguments),e=this.length;d(this,e,b);for(var f=b;e>f;f++)this[f]=this.__value[f];return c},pop:function(){var a=this.length,c=b.apply(this,arguments),e=this.length;return d(this,e,a),c},splice:function(){var a=this.length,b=c.apply(this,arguments),e=this.length;d(this,e,a);for(var f=0;f<this.length;f++)this[f]!=this.__value[f]&&(this[f]=this[f]);return b},__cheetaUpdateInterceptors_:[]}},interceptArray:function(a,b){if(!a.__cheetaUpdateInterceptors_){interceptor=new this.ArrayInterceptor;for(var c in interceptor)a[c]=interceptor[c]}return a.__cheetaUpdateInterceptors_.push(b),a},update:function(a,b,c){for(var d in a.__bindings)for(var e=a.__bindings[d],f=0;f<e.length;f++){var g=e[f];g.update&&g.update(b,c)}},deleteChild:function(a){for(var b in a.__bindings)for(var c=a.__bindings[b],d=0;d<c.length;d++){{c[d]}this.elem.parentNode.removeChild(this.elem)}delete this.__parent.__children[d],delete this.__parent[d]},bindElement:function(a,b,c){if(console.log("bind element: ",a,b,c),void 0===a[b]&&(a[b]=new $cheeta.model.Model,a===this.root)){if(void 0!==window[b])return a[b]=void 0,null;this.interceptProp(a[b],window,b)}var d=a[b],e=c.as||b;return null==d.__bindings[e]&&(d.__bindings[e]=[]),d.__bindings[e].push(c),d.__name=b,d.__parent=a,d},interceptProp:function(a,b,c){console.log("intercepting: ",b,c),null!=b&&Object.defineProperty(b,c,{set:function(b){var c=a.__value;if(c!=b&&(a.__value=b),$cheeta.model.update(a,b,c),b instanceof Object)for(var d in b)if(null!=a[d]){var e=b[d];$cheeta.model.interceptProp(a[d],b,d),b[d]=e}},get:function(){return a.__value},enumerable:!0,configurable:!0})},toExpr:function(a){for(var b="";null!=a.__parent&&null!=a.__name;){var c=a.__name.charAt(0);b=(c>="0"&&"9">=c?"["+a.__name+"]":"."+a.__name)+b,a=a.__parent}return b.substring(1)},bind:function(a,b,c){if(console.log("binding: ",b,c),"."===b.charAt(0))for(key in a[0].__bindings){b=key+b;break}null==a&&(a=[$cheeta.model.root]);var d=b.split(/\./g);b=d[d.length-1];for(var e=d[0],f=$cheeta.model.root,g=0;g<a.length&&(f=a[g],f=function(a,b){for(;a!=$cheeta.model.root;){if(b==a.__name||null!=a.__bindings[b])return a;a=a.__parent}return a}(f,e),f==$cheeta.model.root);g++);if(1==d.length&&f!==$cheeta.model.root)b=f.__name,f=f.__parent;else for(var h=f===$cheeta.model.root?0:1;h<d.length-1;h++){if(null==f[d[h]]&&null==this.bindElement(f,d[h],null==c?null:{elem:c.elem,attr:"bind"}))return null;f=f[d[h]]}return this.bindElement(f,b,c)}},$cheeta.model.root=new $cheeta.model.Model(null),$cheeta.model.root.__value=window,$cheeta.onload=function(){$cheeta.compiler.compile(),$cheeta.location.init()},$cheeta.init=function(){},window.addEventListener("load",$cheeta.onload,!1),$cheeta.directives={"*":[]},$cheeta.directive=function(a,b,c){if(null==b){var d=$cheeta.directives[a];if(null==d)for(var e=$cheeta.directives["*"],f=0;f<e.length;f++)if(0==a.indexOf(e[f].name)){d=e[f];break}return d||(a.indexOf(".",a.length-1)>-1?$cheeta.directive(""):null)}var g=a.indexOf("*",a.length-1);return g>-1?(a=a.substring(0,a.length-1),$cheeta.directives["*"].push({name:"data-"+a,fn:b,order:c},{name:a,fn:b,order:c}),$cheeta.directives["*"][1]):$cheeta.directives["data-"+a]=$cheeta.directives[a]={name:a,fn:b,order:c||1e4}},$cheeta.compiler={recursiveCompile:function(a,b,c){if(b){var d=a;1===b.nodeType&&(d=this.compileDirectives(a,b)),b.__isFor_?b.__isFor_=void 0:this.recursiveCompile(d,b.firstChild),c||this.recursiveCompile(a,b.nextSibling)}},compileElem:function(a,b,c){this.recursiveCompile(a,b,c),this.runFutures()},compileDirectives:function(a,b){for(var c=[],d=0;d<b.attributes.length;d++){var e=b.attributes[d];e.specified&&c.push(e)}c=c.sort(function(a,b){function c(a){return null==a?$cheeta.directive("").order:a.order}return c($cheeta.directive(a.name))-c($cheeta.directive(b.name))});for(var d=0;d<c.length;d++){var e=c[d],f=$cheeta.directive(e.name);if(null!=f&&(a=(f.fn(b,e,a)||[]).concat(a)),b.__isFor_)break}return a},compile:function(){$cheeta.futureEvals=[],scripts=document.getElementsByTagName("script");for(var a=0;a<scripts.length;a++){var b=scripts[a];"text/cj-template"===b.getAttribute("type")&&($cheeta.templates[b.getAttribute("id")]=b.innerHTML)}var c=document.documentElement;this.recursiveCompile([],c),this.runFutures()},runFutures:function(){for(var i=0;i<$cheeta.futureEvals.length;i++)eval($cheeta.futureEvals[i]);for(var i=0;i<$cheeta.futureUpdates.length;i++){var binding=$cheeta.futureUpdates[i];binding.binding.update(binding.model)}$cheeta.futureEvals=[],$cheeta.futureUpdates=[]}},$cheeta.location={keyval:{},watchers:{},watch:function(a,b){a instanceof Function&&(b=a,a=""),null==this.watchers[a]&&(this.watchers[a]=[]),this.watchers[a].push(b)},unwatch:function(a,b){b instanceof Function&&(a=b,b="");var c=this.watchers[b];if(null!=c){var d=c.indexOf(a);d>-1&&c.splice(d,1)}},notify:function(a,b,c){var d=this.watchers[a];if(null!=d)for(var e=0;e<d.length;e++)d[e](b,c)},set:function(a,b){void 0==b&&(b=a,a="");var c=this.keyval[a];this.keyval[a]=b,window.location.hash=this.toHash(),this.notify(a,b,c)},toHash:function(){var a=this.keyval[""]||"";for(var b in this.keyval)b.length>0&&(a+=(a.length>0?"&":"")+b+"="+this.keyval[b]);return a},init:function(){var a=this;window.addEventListener("hashchange",function(){var b,c=window.location.hash,d=0,e="",f={};c=c.substring(c.length>1&&"&"==c.charAt(2)?2:1);for(var g=0;g<=c.length;g++)if("&"==c.charAt(g)||g==c.length){if(b=c.substring(d,g),null==a.keyval[e]||a.keyval[e]!=b){var h=a.keyval[e];a.keyval[e]=b,a.notify(e,b,h)}d=g+1,f[e]=!0,e=""}else"="==c.charAt(g)&&(e=c.substring(d,g),d=g+1);for(var e in a.keyval)if(null==f[e]){var h=a.keyval[e];delete a.keyval[e],a.notify(e,null,h)}},!1)}},function(){var a=function(a,b,c){for(var d=b.value.split(/ *; */g),e=[],f=0;f<d.length;f++){var g=d[f];split=g.split(/ +as +/g);var h=split[0],i=split.length>1?split[1]:null,j={elem:a,attr:"ctrl",as:i};a.__isForElem_&&(j.update=function(a){void 0==a&&this.elem.parentNode.removeChild(this.elem)}),e.push($cheeta.model.bind(c,h,j))}return e};$cheeta.directive("ctrl.",a,200),$cheeta.directive("model.",a,201)}(),$cheeta.futureEvals=[],$cheeta.futureUpdates=[],$cheeta.directive("",function(elem,attr,parentModels){var baseAttrName=attr.name.substring(0==attr.name.indexOf("data-")?5:0,attr.name.length-1);this.parseExpr=function(a,b){var c=null,d=!1,e="",f=-1;a+="";for(var g=0;g<a.length;g++){var h=a.charAt(g);if(null!=c)h==c&&"\\"!=a.charAt(g-1)&&("/"==c&&(d=!0),c=null),e+=h;else if(d)"a">h&&h>"z"&&(d=!1),e+=h;else if(" "==h||"	"==h||"\r"==h||"\n"==h||"!"==h||'"'==h||h>="%"&&"/">=h&&"."!=h||h>=":"&&"?">=h||""==h){if(("'"==h||'"'==h||"/"==h)&&(c=h),f>-1){var i=a.substring(f,g);e+="true"!==i&&"false"!==i&&"undefined"!==i&&"null"!==i&&"NaN"!==i&&isNaN(i)?b(i):i,f=-1}e+=h}else-1==f&&(f=g)}return e.substring(0,e.length-1)};var expr=this.parseExpr(attr.value,function(name){var binding="init"===baseAttrName?null:{elem:elem,attr:attr,baseAttrName:baseAttrName,update:function(model){var val=null;try{val=eval(this.elem.getAttribute(this.attr.name))}catch(e){}val instanceof Object||("text"===this.baseAttrName?(this.elem.innerHTML="",this.elem.appendChild(document.createTextNode(val||""))):"html"===this.baseAttrName?this.elem.innerHTML=val||"":("value"===this.baseAttrName&&void 0!==this.elem.value&&(this.elem.value=val||null),this.elem.setAttribute(this.baseAttrName,val)))}},model=$cheeta.model.bind(parentModels,name,binding);return null!=binding&&$cheeta.futureUpdates.push({binding:binding,model:model}),null!=model?$cheeta.model.toExpr(model):name});"init"===baseAttrName&&$cheeta.futureEvals.push(expr),elem.setAttribute(attr.name,expr)},600),$cheeta.futureEvals=[],$cheeta.directive("eval.",function(a,b){$cheeta.futureEvals.push(b.value)},700),$cheeta.directive("for.",function(a,b,c){a.__isFor_=!0;var d,e,f,g=b.value.split(/ +in +/g);d=g[1],e=g[0],g=d.split(/ +as +/g),d=g[0],f=g.length>1?g[1]:null;var h={elem:a,arrayVar:e,arrayName:d,as:f,update:function(b,c){if((b instanceof Object||c instanceof Object)&&($cheeta.model.interceptArray(b,this.update),b=null==b?0:b.length,c=null==c?0:c.length),c>b)for(var d=c-1;d>=b;d--)delete i[d];else if(b>c)for(var e=this.arrayVar,f=this.arrayName,d=c;b>d;d++){var g=this.elem.cloneNode();g.removeAttribute("for."),g.removeAttribute("data-for."),g.__isForElem_=!0,g.setAttribute("model.",f+"."+d+" as "+e+(this.elem.getAttribute("model.")?";"+this.elem.getAttribute("model.").value:"")),g.style.display="",a.parentNode.insertBefore(g,this.elem),$cheeta.compiler.compileElem(this.__parentModels,g,!0)}}},i=$cheeta.model.bind(c,d,h);return h.__parentModels=c,a.style.display="none",[i]},100),$cheeta.templates={},$cheeta.directive("template.",function(a,b,c){a.innerHTML=$cheeta.templates[b.value]||a.innerHTML;for(var d=a.childNodes,e=0;e<d.length;e++)$cheeta.compiler.compileElem(c,d[e])},500);