/*! cheetajs 2013-12-20 */
if(!$cheeta){var $cheeta=$cheeta||function(a){var b=[a];return b.on=function(b,c){for(var d=b.split(" "),e=0;e<d.length;e++)d[e].length>0&&a.addEventListener(d[e],c,!1)},b.off=function(b,c){for(var d=b.split(" "),e=0;e<d.length;e++)d[e].length>0&&a.removeEventListener(d[e],c,!1)},b};window.$cheeta=window.Oo=$cheeta}$cheeta.model=$cheeta.model||{Model:function(a,b){this.value=void 0,this.listeners=[],this.parent=a,this.names=[b],this.children={},this.toExpr=function(){for(var a="",b=this;null!=b.parent&&null!=b.names[0];){var c=b.names[0].charAt(0);a=(c>="0"&&"9">=c?"["+b.names[0]+"]":"."+b.names[0])+a,b=b.parent}return a.substring(1)},this.createOrGetChild=function(a){var b=this.children[a];return void 0===b&&(b=new $cheeta.model.Model(this,a),$cheeta.model.interceptProp(b,this.value,a),this.children[a]=b,b.value=null==this.value?void 0:this.value[a]),null==this.value&&(this.value=this.isArray?[]:{}),b},this.alias=function(a){null!=a&&a!=this.names[0]&&this.names.push(a)},this.addChangeListener=function(a,b){if(a){var c=function(){a.apply(b,arguments)};this.listeners.push(c),null!=this.value&&$cheeta.future.evals.push(c)}return a},this.removeChangeListener=function(a){var b=this.listeners.indexOf(a);return b>-1?this.listeners.splice(b,1):null},this.valueChange=function(a,b){if(a!=b)for(var c=0;c<this.listeners.length;c++)this.listeners[c](a,b);return this},this.addDirective=function(a){null==this.directives&&(this.directives={}),this.directives[a.name]=a,a.isGlobal()&&(null==this.directives["/"]&&(this.directives["/"]=[]),this.directives["/"].push(a.name.length-1))},this.getDirective=function(a){return null==this.directives?null:this.directives[a]}},ArrayInterceptor:function(a){return{push:function(){var b=this.length,c=Array.prototype.push.apply(this,arguments),d=this.length;return a.valueChange(d,b),c},pop:function(){var b=this.length,c=Array.prototype.pop.apply(this,arguments),d=this.length;return a.valueChange(d,b),c},shift:function(){return this.splice(0,1)[0]},unshift:function(){var a=[].slice.apply(arguments);return a.unshift(0,0),this.splice.apply(this,a),this.length},splice:function(){var b=this.length,c=Array.prototype.splice.apply(this,arguments),d=this.length;return a.valueChange(d,b),c}}},interceptArray:function(a){if(null!=a.value){var b=new this.ArrayInterceptor(a);for(var c in b){if(a.value[c]==b[c])break;a.value[c]=b[c]}}},interceptProp:function(a,b,c){if(console.log("intercepting: ",b,c),null!=b){var d=b[c],e=a.parent.children&&null!=a.parent.children[c],f=e?null:Object.getOwnPropertyDescriptor(b,c);try{Object.defineProperty(b,c,{set:function(c){f&&f.set&&f.set.apply(b,arguments),c=f&&f.get&&f.get.apply(b)||c;var d=a.value;if(d!=c&&(a.value=c,a.isArray&&$cheeta.model.interceptArray(a),a.valueChange(c,d),c instanceof Object))for(var e in a.children){var g=c[e];$cheeta.model.interceptProp(a.children[e],c,e),c[e]=g}},get:function(){return f&&f.get&&f.get.apply(b)||a.value},enumerable:!0,configurable:!0})}catch(g){if(!(g instanceof TypeError))throw g;return}b[c]=d}},findParentModel:function(a,b){for(;a!=$cheeta.model.root;){if(a.names.indexOf(b)>-1)return a;a=a.parent}return a},get:function(a){return this.createOrGetModel(null,a)},createOrGetModel:function(a,b){if(null==b)return $cheeta.model.root;if(null==a&&(a=[$cheeta.model.root]),"$i"===b)for(var c=a.length-1;c>=0;c--)if("$i"==a[c].names[0])return a[c];"."===b.charAt(0)&&(b=a[0].names[0]+b);var d=b.split(/\./g);b=d[d.length-1];for(var e=d[0],f=$cheeta.model.root,g=0;g<a.length&&(f=a[g],f=this.findParentModel(f,e),f==$cheeta.model.root);g++);if(1==d.length&&f!==$cheeta.model.root)b=f.names[0],f=f.parent;else for(var c=f===$cheeta.model.root?0:1;c<d.length-1;c++)f=f.children[d[c]]||f.createOrGetChild(d[c]);return f.createOrGetChild(b)}},$cheeta.model.root=$cheeta.model.root||new $cheeta.model.Model(null),$cheeta.model.root.value=window,$cheeta.root=$cheeta.model.root,window.addEventListener("load",function(){$cheeta.isInitialized||($cheeta.isInitialized=!0,$cheeta.future={evals:[{}]},$cheeta.hash.init(),$cheeta.compiler.compile([$cheeta.model.root],document.documentElement))},!1),$cheeta.Directive=function(name,model){this.name=name,this.isGlobal=function(){return this.name.indexOf("*",this.name.length-1)>-1},this.order=1e3,this.setOrder=function(a){return this.order=a,this},this.onAttach=function(a){return this.attach=a,this},this.onDetach=function(a){return this.detach=a,this},this.onModelChange=function(fn){var origAttach=this.attach,modelChangeListener;return this.onAttach(function(elem,attrName,parentModels){var models=[];return origAttach&&origAttach(),this.resolveModelNames(elem,attrName,parentModels,function(model){models.push(model),modelChangeListener=model.addChangeListener(function(){var val=eval(elem.getAttribute(attrName));fn.apply(this,[val,elem,attrName,parentModels])},this)}),models}),this.onDetach(function(a,b,c){var d=[];return this.resolveModelNames(a,b,c,function(c){console.log("directive unbind: ",a,b),d.push(c),c.removeChangeListener(modelChangeListener)},!0),d}),this},this.resolveModelNames=function(a,b,c,d,e){var f="",g=[],h=this;return this.tokenizeAttrVal(a.getAttribute(b),{onVar:function(a){var b=$cheeta.model.createOrGetModel(c,a);g.push(b),f+=b.toExpr(),d&&d.apply(h,[b])},onLiteral:function(a){f+=a},onFnVar:function(a){f+=a}}),e||a.setAttribute(b,f),f},this.tokenizeAttrVal=function(a,b){var c=null,d=!1,e=-1;a+="";for(var f=0;f<a.length;f++){var g=a.charAt(f);if(null!=c)g==c&&"\\"!=a.charAt(f-1)&&("/"==c&&(d=!0),c=null),b.onLiteral(g);else if(d)"a">g&&g>"z"&&(d=!1),b.onLiteral(g);else if(" "===g||"	"===g||"\r"===g||"\n"===g||"!"===g||'"'===g||"["===g||"]"===g||g>="%"&&"/">=g&&"."!=g||g>=":"&&"?">=g||g>="{"&&"~">=g||"^"===g||""==g){if(("'"===g||'"'===g||"/"===g)&&(c=g),e>-1){var h=a.substring(e,f);if("true"!==h&&"false"!==h&&"undefined"!==h&&"null"!==h&&"NaN"!==h&&isNaN(h)){for(var i=f;" "==a.charAt(i);)i++;if("("==a.charAt(i)){var j=h.lastIndexOf(".");j>-1?(b.onFnVar(h.substring(0,j)),b.onLiteral(h.substring(j))):b.onLiteral(h)}else b.onVar(h)}else b.onLiteral(h);e=-1}""!==g&&b.onLiteral(g)}else-1==e&&(e=f)}},$cheeta.model.get(model).addDirective(this)},$cheeta.Directive.get=function(a,b){0==a.indexOf("data-")&&(a=a.substring(5));var c=a.indexOf(".",a.length-1)>-1,d=[];b=b||[$cheeta.model.root];for(var e=0;e<b.length;e++){var f=b[e],g=f.getDirective(a);if(null==g&&null!=f.directives&&null!=f.directives["/"]&&c)for(var h=f.directives["/"],i=0;i<h.length;i++)g=f.directives[a.substring(0,h[i])+"*"],null!=g&&d.push(g);else null!=g&&d.push(g)}return 0==d.length?$cheeta.Directive.get(""):d},$cheeta.compiler={recursiveCompile:function(a,b,c,d,e,f){if(b){var g=a;if(!f&&1===b.nodeType){if("script"==b.tagName.toLowerCase()&&!d){var h=b;if(!c||null!=h.parentNode&&"head"==h.parentNode.tagName.toLowerCase()||null!=h.type&&""!=h.type&&"text/javascript"!==h.type)"text/cheeta-template"===h.type&&($cheeta.templates[h.getAttribute("id")]=h.innerHTML||"");else{var i=h.innerHTML||"",j=document.getElementsByTagName("head")[0]||document.documentElement;h=document.createElement("script"),h.type="text/javascript",h.appendChild(document.createTextNode(i)),j.insertBefore(h,j.firstChild),j.removeChild(h)}}g=this.compileDirectives(a,b,d)}b.__isFor_?b.__isFor_=void 0:this.recursiveCompile(g,b.firstChild,c,d),e||this.recursiveCompile(a,b.nextSibling,c,d)}},doCompile:function(){this.recursiveCompile.apply(this,arguments),this.runFutures()},compile:function(a,b,c){this.doCompile(a,b,c,!1,!0)},compileChildren:function(a,b,c){this.doCompile(a,b,c,!1,!0,!0)},uncompile:function(a,b){this.doCompile(a,b,!1,!0,!0)},uncompileChildren:function(a,b){this.doCompile(a,b,!1,!0,!0,!0)},compileDirectives:function(a,b,c){for(var d=this.getAttrDirectives(b,c,a),e=0;e<d.length;e++){var f,g=d[e];if(f=c?g.directive.detach(b,g.attrName,a):g.directive.attach(b,g.attrName,a),a=(f||[]).concat(a),b.__isFor_)break}return a},getAttrDirectives:function(a,b,c){function d(a){for(var b=$cheeta.Directive.get(a.name,c),d=0;d<b.length;d++){var f,g={attrName:a.name,directive:b[d]};for(f=e.length-1;f>=0&&!(g.directive.order>e[f].directive.order);f--);e.splice(f+1,0,g)}}for(var e=[],f=[],g=0;g<a.attributes.length;g++){var h=a.attributes[g];if(h.specified){var i=h.name.split(".");if(""!=i[i.length-1])continue;if(i.pop(),i.length>1)for(var j=0;j<i.length;j++)f.push({name:i[j]+".",value:h.value});else d(h)}}for(;f.length;){var h=f.pop();null==a.getAttribute(h.name)&&a.setAttribute(h.name,h.value),d(a.attributes[h.name])}return e},runFutures:function(){var runs=$cheeta.future.evals.slice(0);$cheeta.future.evals=[{}];for(var elem in runs[0])for(var attrName in runs[0][elem])console.log("onchange ",elem,attrName),runs[0][elem][attrName](elem,attrName);for(var i=0;i<runs.length;i++){var expr=runs[i];expr instanceof Function?expr():eval(expr)}}},$cheeta.XHR=function(a){a=a||this;var b=this.send,c=this.open,d=new XMLHttpRequest;d.open=function(){return c.apply(d,arguments),d},d.send=function(){return b.apply(d,arguments),d};var e=[],f=[],g=[],h=[];return d.onError=function(a){return g.push(a),d},d.onSuccess=function(a){return e.push(a),d},d.onComplete=function(a){return f.push(a),d},d.onStateChange=function(a){h.push(a)},d.onreadystatechange=function(){if(4==d.readyState){if(200<=d.status&&d.status<300)for(var b=0;b<e.length;b++)e[b].apply(a,[d]);else for(var b=0;b<g.length;b++)g[b].apply(a,[d]);for(var b=0;b<f.length;b++)f[b].apply(a,[d])}for(var b=0;b<h.length;b++)h[b].apply(a,[d])},Object.defineProperty(d,"data",{get:function(){return"application/json"==d.getResponseHeader("Content-Type")?JSON.stringify(d.responseText):d.responseText},enumerable:!0,configurable:!0}),d},$cheeta.XHR.prototype=new XMLHttpRequest,function(){new $cheeta.Directive("bind.").onAttach(function(elem,attrName,parentModels){this.fn=this.fn||{},this.fn[elem]=function(e){setTimeout(function(){eval(elem.getAttribute(attrName)+"='"+elem.value.replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'")},0)},$cheeta.Directive.get("value.")[0].attach(elem,attrName,parentModels),$cheeta(elem).on("keydown keyup change",this.fn[elem])}).onDetach(function(a){this.fn[a]&&$cheeta(a).off("keydown keyup change",this.fn[a])}).setOrder(800)}(),function(){var a=function(a,b,c){for(var d=a.getAttribute(b).split(/ *; */g),e=[],f=0;f<d.length;f++){var g=d[f];split=g.split(/ +as +/g);var h=split[0],i=split.length>1?split[1]:null,j=$cheeta.model.createOrGetModel(c,h);j.alias(i),e.push(j)}return e};new $cheeta.Directive("ctrl.").setOrder(200).onAttach(a),new $cheeta.Directive("model.").setOrder(200).onAttach(a)}(),new $cheeta.Directive("").onModelChange(function(a,b,c){var d=c.substring(0==c.indexOf("data-")?5:0,c.length-1);b.setAttribute(d,a)}),new $cheeta.Directive("for.").setOrder(100).onAttach(function(a,b,c){a.__isFor_=!0;var d=a.getAttribute(b).split(/ +in +/g),e=d[1],f=d[0];d=e.split(/ +as +/g),e=d[0];var g=d.length>1?d[1]:null,h=[],i=function(b,d){if((b instanceof Object||d instanceof Object)&&(b=null==b?0:b.length,d=null==d?0:d.length),d>b)for(var g=d-1;g>=b;g--){var i=h.pop();i.parentNode.removeChild(i),delete j.children[g]}else if(b>d)for(var g=d;b>g;g++){var k=a.cloneNode();h.push(k),k.removeAttribute("for."),k.removeAttribute("data-for."),k.setAttribute("model.",e+"."+g+" as "+f+(a.getAttribute("model.")?";"+a.getAttribute("model.").value:"")),k.style.display="",a.parentNode.insertBefore(k,a);var l=new $cheeta.model.Model($cheeta.model.root,"$i");l.toExpr=function(){return g},$cheeta.compiler.compile(c.concat(l),k)}},j=$cheeta.model.createOrGetModel(c,e);return j.addChangeListener(i,this),j.alias(g),a.style.display="none",j.isArray=!0,[j]}),new $cheeta.Directive("html.").onModelChange(function(a,b){a!=b.innerHTML&&(b.innerHTML=a||"")}),new $cheeta.Directive("init.").onAttach(function(a,b,c){var d=this.resolveModelNames(a,b,c);$cheeta.future.evals.push(d)}),$cheeta.keyconsts={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,space:32,pause:19,"break":19,capslock:20,escape:27,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,"down arrow":40,insert:45,"delete":46,colon:58,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,semicolon:186,comma:188,dash:189,dot:190},new $cheeta.Directive("on*").onAttach(function(elem,attrName,parentModels){this.resolveModelNames(elem,attrName,parentModels);var baseAttrName=attrName.substring(0==attrName.indexOf("data-")?7:2,attrName.length-1),split=baseAttrName.split("-");!function bindEvent(event,key,attrName){var fn=function(e){eval(elem.getAttribute(attrName))};if(elem.__$cheeta_event_listeners=elem.__$cheeta_event_listeners||[],0==event.indexOf("key")){var keyFn=function(a){var b=1;if(1==key.length)b=key.charCodeAt(0);else if(b=$cheeta.keyconsts[key],null==b&&(b=parseInt(key),isNaN(b)))throw"unknown key: "+key;a.which==b&&fn.apply(elem,[a])};elem.__$cheeta_event_listeners.push({event:event,fn:keyFn}),elem.addEventListener(event,keyFn,!1)}else{var listenerFn=function(a){fn.apply(elem,[a])};elem.__$cheeta_event_listeners.push({event:event,fn:listenerFn}),elem.addEventListener(event,listenerFn,!1)}}(split[0],split[1],attrName)}).onDetach(function(a){for(var b=a.__$cheeta_event_listeners,c=0;c<b.length;c++){var d=b[c];a.removeEventListener(d.event,d.fn,!1)}}),new $cheeta.Directive("text.").onModelChange(function(a,b){b.innerHTML="",b.appendChild(document.createTextNode(a||"")),console.log("innerhtml after: "+b.innerHTML)}),new $cheeta.Directive("value.").onModelChange(function(a,b){b.value!=a&&(b.value=a||null)}),function(){$cheeta.templates=$cheeta.templates||{};var a=new $cheeta.Directive("view.").onModelChange(function(a,b,c,d){if(!b.__$cheeta_view_is_loading&&null!=a){b.__$cheeta_view_is_loading=!0;try{var e=$cheeta.templates[a];if(null!=e)this.loadView(b,e,d);else{var f=0===a.indexOf("/")?this.baseURL+a:a;null!=this.cache[f]?this.loadView(b,this.cache[f],d):new $cheeta.XHR(this).open("get",f).onSuccess(function(a){this.cache[f]=a.data,this.loadView(b,a.data,d)}).send()}}finally{b.__$cheeta_view_is_loading=!1}}}).setOrder(900);a.baseURL=window.location.protocol+"//"+window.location.hostname+(window.location.port&&":"+window.location.port)+window.location.pathname,a.loadView=function(a,b,c){$cheeta.compiler.uncompileChildren(c,a),a.innerHTML=b,$cheeta.compiler.compileChildren(c,a,!0)},a.cache={}}(),$cheeta.hash={keyval:{},watchers:{},watch:function(a,b){a instanceof Function&&(b=a,a=""),null==this.watchers[a]&&(this.watchers[a]=[]),-1===this.watchers[a].indexOf(b)&&this.watchers[a].push(b)},unwatch:function(a,b){b instanceof Function&&(a=b,b="");var c=this.watchers[b];if(null!=c){var d=c.indexOf(a);d>-1&&c.splice(d,1)}},notify:function(a,b,c){var d=this.watchers[a];if(null!=d)for(var e=0;e<d.length;e++)d[e](b,c)},set:function(a,b){void 0==b&&(b=a,a="");var c=this.keyval[a];this.keyval[a]=b;var d=function(){var a=this.keyval[""]||"";for(var b in this.keyval)b.length>0&&(a+=(a.length>0?"&":"")+b+"="+this.keyval[b]);return a};window.location.hash=d(),this.notify(a,b,c)},init:function(){var a=this;window.addEventListener("hashchange",function(){var b,c=window.location.hash,d=0,e="",f={};try{c=c.substring(c.length>1&&"&"==c.charAt(2)?2:1);for(var g=0;g<=c.length;g++)if("&"==c.charAt(g)||g==c.length){if(b=c.substring(d,g),null==a.keyval[e]||a.keyval[e]!=b){var h=a.keyval[e];a.keyval[e]=b,a.notify(e,b,h)}d=g+1,f[e]=!0,e=""}else"="==c.charAt(g)&&(e=c.substring(d,g),d=g+1);for(var e in a.keyval)if(null==f[e]){var h=a.keyval[e];delete a.keyval[e],a.notify(e,null,h)}}finally{a.value=c}},!1)},get value(){return window.location.hash.length>0?window.location.hash.substring(1):window.location.hash},set value(a){return window.location.hash="#"+a}},$cheeta.route=$cheeta.route||function(a,b){if(null==a)return null;var c=0,d=null;for(var e in a)0==b.indexOf(e)&&c<e.length&&(c=e.length,d=a[e]);return d};