/*! cheetajs 2015-03-14 */
Object.isString=function(a){return"string"==typeof a||a instanceof String},Object.isFunction=function(a){return"function"==typeof a},Object.isBoolean=function(a){return"boolean"==typeof a},Element.prototype.attr||(Element.prototype.attr=function(a,b){return null!=b?(this.setAttribute(a,b),this):this.getAttribute(a)||this.getAttribute("data-"+a)||this.getAttribute("x-"+a)}),Element.prototype.addClass||(Element.prototype.addClass=function(a){return null!=a&&(this.hasClass(a)||this.setAttribute("class",(this.getAttribute("class")?this.getAttribute("class")+" ":"")+a)),this}),Element.prototype.removeClass||(Element.prototype.removeClass=function(a){return null!=a&&this.hasClass(a)&&this.setAttribute("class",this.getAttribute("class").replace(new RegExp("("+a+"$)|( "+a+")","g"),"")),this}),Element.prototype.hasClass||(Element.prototype.hasClass=function(a){return this.getAttribute("class")&&this.getAttribute("class").split(" ").indexOf(a)>-1}),Element.prototype.add||(Element.prototype.add=function(a,b){if(a&&null!=a.length&&null!=a[0])for(var c=0;c<a.length;c++)this.add(a[c],b);else this.insertBefore(a,b&&this.childNodes[b]);return a.remove(),this}),Element.prototype.addBefore||(Element.prototype.addBefore=function(a){if(a&&null!=a.length&&null!=a[0])for(var b=0;b<a.length;b++)this.addBefore(a[b]);else this.parentNode.insertBefore(a,this);return this}),Element.prototype.addAfter||(Element.prototype.addAfter=function(a){if(a&&null!=a.length&&null!=a[0])for(var b=0;b<a.length;b++)this.addAfter(a[b]);else this.parentNode.insertBefore(a,this.nextSibling);return this}),Element.prototype.remove||(Element.prototype.remove=function(){return this.parentNode&&this.parentNode.removeChild(this),this}),Element.prototype.html||(Element.prototype.html=function(a){return this.innerHTML=a,this}),Element.prototype.wrap||(Element.prototype.wrap=function(a){return this.addAfter(a),this.remove(),a.add(this),this}),document.create||(document.create=function(a){if("<"===a.charAt(0)){var b=document.createElement("div");return b.innerHTML=a,b.removeChild(b.firstChild)}return document.createElement(a)}),window.El=document.create,function(){for(var a=Array.prototype.slice.call(arguments),b=0;b<a.length;b++)(a[b].prototype?a[b].prototype:a[b]).on=(a[b].prototype?a[b].prototype:a[b]).on||function(a,b){for(var c=a.split(" "),d=0;d<c.length;d++)c[d].length>0&&this.addEventListener(c[d],b,!1)}}(Element,window,document),function(){for(var a=Array.prototype.slice.call(arguments),b=0;b<a.length;b++)(a[b].prototype?a[b].prototype:a[b]).off=(a[b].prototype?a[b].prototype:a[b]).off||function(a,b){for(var c=a.split(" "),d=0;d<c.length;d++)c[d].length>0&&this.removeEventListener(c[d],b,!1)}}(Element,window,document),window.El=function(a){if("string"==typeof a||a instanceof String){if("<"!==a[0])return $cheeta(document.createElement(a));var b=document.createElement("div");return b.innerHTML=a,$cheeta(b.firstChild)}var c=[];return c.push(a),c.on=function(b,d){for(var e=b.split(" "),f=0;f<e.length;f++)e[f].length>0&&a.addEventListener(e[f],d,!1);return c},c.off=function(b,d){for(var e=b.split(" "),f=0;f<e.length;f++)e[f].length>0&&a.removeEventListener(e[f],d,!1);return c},c.attr=function(b,d){return a.setAttribute(b,d),c},c},window.$cheeta=window.Oo={},$cheeta.model=$cheeta.model||{Model:function(a,b){this.value=void 0,this.bindings=[],this.parent=a,this.names=[b],this.children={},this.ref=function(){for(var a="",b=this;null!=b.parent&&null!=b.names[0];)a=(b.hasSpecialChar?"['"+b.names[0]+"']":"."+b.names[0])+a,b=b.parent;return a.substring(1)},this.getValue=function(){for(var a=[],b=this;null!=b.parent&&null!=b.names[0];)a.push(b.hasSpecialChar?"['"+b.names[0]+"']":"."+b.names[0]),b=b.parent;for(var c=window,d=a.length-1;d>=0&&null!=c;d--)c=c[a[d]];return null===c&&d>0?void 0:c},this.child=function(a,b){null==this.value&&(this.value=this.isArray?[]:{});var c=this.children[a];return void 0===c&&(c=new $cheeta.model.Model(this,a),$cheeta.model.interceptProp(c,this.value,a),this.children[a]=c,c.value=null==this.value?void 0:this.value[a]),c.hasSpecialChar=b,c},this.alias=function(a){null!=a&&a!==this.names[0]&&this.names.push(a)},this.bind=function(a,b,c){c&&(this.bindings.push({elem:a,attrName:b}),a.addEventListener("$cheetaMC-"+b+"-"+this.ref(),c,!1),null!=this.value&&$cheeta.future.evals.push([c,{type:"$cheetaMC-"+b+"-"+this.ref(),detail:{value:this.value,oldValue:null,target:this}}]))},this.unbind=function(a,b,c){a.removeEventListener("$cheetaMC-"+b,c,!1);for(var d=0;d<this.bindings.length;d++){var e=this.bindings[d];e.elem===a&&e.attrName===b&&this.bindings.splice(d,1)}},this.valueChange=function(a,b){if(a!==b)for(var c=0;c<this.bindings.length;c++)this.bindings[c].elem.dispatchEvent(new CustomEvent("$cheetaMC-"+this.bindings[c].attrName+"-"+this.ref(),{detail:{value:a,oldValue:b,target:this}}));return this},this.addDirective=function(a){null==this.directives&&(this.directives={}),this.directives[a.name]=a,a.isGlobal()&&(null==this.directives["/"]&&(this.directives["/"]=[]),this.directives["/"].push(a.name.length-1))},this.getDirective=function(a){return null==this.directives?null:this.directives[a]}},interceptArray:function(a){if(null!=a.value){var b=new this.ArrayInterceptor(a);for(var c in b){if(a.value[c]===b[c])break;a.value[c]=b[c]}}},interceptProp:function(a,b,c){if(null!=b){var d=b[c],e=a.parent.children&&null!=a.parent.children[c],f=e?null:Object.getOwnPropertyDescriptor(b,c);try{Object.defineProperty(b,c,{set:function(c){f&&f.set&&f.set.apply(b,arguments),c=f&&f.get&&f.get.apply(b)||c;var d=a.value;if(d!==c&&(a.value=c,a.isArray&&$cheeta.model.interceptArray(a),a.valueChange(c,d),c instanceof Object))for(var e in a.children){var g=c[e];if(null!=d){var h=d[e];delete d[e],d[e]=h}$cheeta.model.interceptProp(a.children[e],c,e),c[e]=g}},get:function(){return f&&f.get&&f.get.apply(b)||a.value},enumerable:!0,configurable:!0})}catch(g){if(!(g instanceof TypeError))throw g;return}b[c]=d}},findParentModel:function(a,b){for(;a!==$cheeta.model.root;){if(a.names.indexOf(b)>-1)return a;a=a.parent}return a},get:function(a){return this.createOrGetModel(null,a)},createOrGetModel:function(a,b){if(null==b)return $cheeta.model.root;if(null==a&&(a=[$cheeta.model.root]),"$i"===b)for(var c=a.length-1;c>=0;c--)if("$i"===a[c].names[0])return a[c];0===b.search(/^ *\./)&&(b=a[0].names[0]+b);for(var d=b.split(/ *\. *| *\[ */g),e=d[0],f=$cheeta.model.root,g=0;g<a.length&&(f=a[g],f=this.findParentModel(f,e),f===$cheeta.model.root);g++);for(var h=f===$cheeta.model.root?0:1;h<d.length;h++){var i=!1,j=d[h];if(j.search(/\( *$/)>-1)return j.search(/\] */)>-1&&(j="["+j),[f,j];j.search(/\] *$/)>-1&&(j=j.replace(/^ *'|'? *] *$/g,""),i=!0),f=f.children[j]||f.child(j,i)}return f}},$cheeta.refresh=function(a){var b=$cheeta.model.createOrGetModel(null,a);b.valueChange(b.getValue(),null)},$cheeta.model.root=$cheeta.model.root||new $cheeta.model.Model(null),$cheeta.model.root.value=window,$cheeta.root=$cheeta.model.root,$cheeta.watchFns=[],$cheeta.watch=function(a,b){$cheeta.watchFns.push(b);var c=document.createElement("div");c.setAttribute("style","display:none"),c.setAttribute("watch.",a),c.setAttribute("onwatch.","$cheeta.watchFns["+($cheeta.watchFns.length-1)+"]()"),document.body.appendChild(c),$cheeta.compiler.compile([$cheeta.model.root],c)},$cheeta.future=function(a){$cheeta.future.evals.push([a])},$cheeta.future.evals=$cheeta.future.evals||[],$cheeta.url=function(a){var b=document.createElement("a");return b.href=a,b.param=function(a,c){return b.search+=(b.search.indexOf("?")>-1?"&":"?")+a+"="+c,b},b.params=function(a){if(a)for(var c in a)$cheeta.isFunction(a[c])||b.param(c,a[c]);return b},b},$cheeta.copy=function(a,b,c){for(var d in a)c===!0||$cheeta.isFunction(c)&&c(d,a[d])?b[d]=a[d]:$cheeta.isFunction(a[d])||(b[d]=a[d])},window.addEventListener("load",function(){$cheeta.isInitialized||($cheeta.isInitialized=!0,$cheeta.hash.init(),$cheeta.compiler.compile([$cheeta.model.root],document.documentElement))},!1),$cheeta.Directive=function(name,model){this.name=name,this.isGlobal=function(){return this.name.indexOf("*",this.name.length-1)>-1},this.order=1e3,this.setOrder=function(a){return this.order=a,this},this.onPreAttach=function(a){return this.preAttach=this.preAttach?function(){this.preAttach.apply(this,arguments),a.apply(this,arguments)}:a,this},this.onAttach=function(a){return this.attach=this.attach?function(){this.attach.apply(this,arguments),a.apply(this,arguments)}:a,this},this.onPostAttach=function(a){return this.postAttach=this.postAttach?function(){this.postAttach.apply(this,arguments),a.apply(this,arguments)}:a,this},this.onDetach=function(a){return this.detach=this.detach?function(){this.detach.apply(this,arguments),a.apply(this,arguments)}:a,this},this.onModelValueChange=function(changeFn,attrValueTransformer){var origAttach=this.attach,origDetach=this.detach;return this.attach=function(elem,attrName,parentModels){if(origAttach&&origAttach.apply(this),!this.resolveModelNames(elem,attrName,parentModels,function(model){var _this=this;model.bind(elem,attrName,function(){var val=eval(elem.getAttribute(attrName));changeFn&&changeFn.apply(_this,[val,elem,attrName,parentModels])})},attrValueTransformer)){var val=eval(elem.getAttribute(attrName));changeFn&&changeFn.apply(this,[val,elem,attrName,parentModels])}},this.detach=function(a,b,c){origDetach&&origDetach.apply(this),this.resolveModelNames(a,b,c,function(c){c.unbind(a,b)},!0)},this},this.resolveModelNames=function(a,b,c,d,e){var f=this,g=!1,h=this.parseModelVars(e&&e(a,b)||a.getAttribute(b),function(a){var b=$cheeta.model.createOrGetModel(c,a.trim());if(g=!0,b instanceof Array){var e=b[0].ref();return e+(e.length>0&&"["!==b[1][0]?".":"")+b[1]}return d&&d.call(f,b),b.ref()});return e||a.setAttribute(b,h),g};var modelVarRegExp=/(((((\. *)?[^ \.!%-\-/:-?\^\[\]{-~\t\r\n'"]+)|\[ *([^ \.!%-\-/:-?\^\[\]{-~\t\r\n'"]+|'(\\'|[^'])*') *\]) *)+\(?)|('(\\'|[^'])*')/g,reservedWords="(abstract|else|instanceof|super|boolean|enum|int|switch|break|export|interface|synchronized|byte|extends|let|this|case|false|long|throw|catch|final|native|throws|char|finally|new|transient|class|float|null|true|const|for|package|try|continue|function|private|typeof|debugger|goto|protected|var|default|if|public|void|delete|implements|return|volatile|do|import|short|while|double|in|static|with)";this.parseModelVars=function(a,b){function c(a){return a.replace(modelVarRegExp,function(a){if("'"!==a.charAt(0)&&'"'!==a.charAt(0)&&"true"!==a&&"false"!==a&&"undefined"!==a&&"null"!==a&&"NaN"!==a&&isNaN(a)){a=a.replace(/\[ *([^0-9'"].*?)\]/g,function(a,b){return"["+c(b)+"]"});var d="";return a=a.replace(new RegExp("(^|\\W)"+reservedWords+"(\\W|$)","g"),function(a,b,c,e){return d+=c+"|",b+"'"+c+"'"+e}),d.length>0?(a=c(a),a.replace(new RegExp("'("+d.slice(0,-1)+")'","g"),function(a){return a.slice(1,-1)})):b.call(this,a)}return a})}return c(a)},this.extend=function(){for(var a=Array.prototype.slice.call(arguments,0),b=0;b<a.length;b++)this.onAttach(a.attach),this.onDetach(a.detach);return this},$cheeta.model.get(model).addDirective(this)},$cheeta.Directive.get=function(a,b){0===a.indexOf("data-")&&(a=a.substring(5));var c=a.indexOf(".",a.length-1)>-1;b=b||[$cheeta.model.root];for(var d=0;d<b.length;d++){var e=b[d],f=e.getDirective(a);if(null==f&&null!=e.directives&&null!=e.directives["/"]&&c){for(var g=e.directives["/"],h=0;h<g.length;h++)if(f=e.directives[a.substring(0,g[h])+"*"],null!=f)return f}else if(null!=f)return f}return $cheeta.Directive.get("")},$cheeta.compiler={recursiveCompile:function(a,b,c,d,e,f){if(b){var g=a;if(!f&&1===b.nodeType){if("script"===b.tagName.toLowerCase()&&!d)if(!c||null!=b.parentNode&&"head"===b.parentNode.tagName.toLowerCase()||null!=b.type&&""!==b.type&&"text/javascript"!==b.type)"text/cheeta-template"===b.type&&($cheeta.templates[b.getAttribute("id")]=b.innerHTML||"");else{var h=b.innerHTML||"",i=document.getElementsByTagName("head")[0]||document.documentElement,j=document.createElement("script");j.type="text/javascript",j.appendChild(document.createTextNode(h)),i.insertBefore(j,i.firstChild),i.removeChild(j)}g=this.compileDirectives(a,b,d)}b.__shouldSkipChildren_?b.__shouldSkipChildren_=void 0:this.recursiveCompile(g,b.firstChild,c,d),e||this.recursiveCompile(a,b.nextSibling,c,d)}},doCompile:function(){this.recursiveCompile.apply(this,arguments),this.runFutures()},compile:function(a,b,c){this.doCompile(a,b,c,!1,!0)},compileChildren:function(a,b,c){this.doCompile(a,b,c,!1,!0,!0)},uncompile:function(a,b){this.doCompile(a,b,!1,!0,!0)},uncompileChildren:function(a,b){this.doCompile(a,b,!1,!0,!0,!0)},compileDirectives:function(a,b,c){for(var d=this.getAttrDirectives(b,c,a),e=0;e<d.length;e++){var f,g=d[e];if(c?g.directive.detach&&(f=g.directive.detach(b,g.attrName,a)):(g.directive.attach&&(f=g.directive.attach(b,g.attrName,a)),g.directive.postAttach&&g.directive.postAttach(b,g.attrName,a)),a=(f||[]).concat(a),"for."===g.directive.name||"show."===g.directive.name){b.__shouldSkipChildren_=!0;break}}return a},getAttrDirectives:function(a,b,c){function d(b){var d=$cheeta.Directive.get(b.name,c);d.preAttach&&d.preAttach(a,b.name,c);var e,g={attrName:b.name,directive:d};for(e=f.length-1;e>=0&&!(g.directive.order>f[e].directive.order);e--);f.splice(e+1,0,g)}for(var e,f=[],g=[],h=0;h<a.attributes.length;h++)if(e=a.attributes[h],e.specified){var i=e.name.split(".");if(""!==i[i.length-1])continue;if(i.pop(),i.length>1){for(var j=0;j<i.length;j++)g.push({name:i[j]+".",value:e.value});a.removeAttribute(e.name)}else d(e)}for(;g.length;)e=g.pop(),null==a.getAttribute(e.name)&&a.setAttribute(e.name,e.value),d(a.attributes[e.name]);return f},runFutures:function(){var runs=$cheeta.future.evals.slice(0);$cheeta.future.evals=[];for(var i=0;i<runs.length;i++){var expr=runs[i];Array.isArray(expr)?expr[0].call(expr.slice(1)):eval(expr)}}},$cheeta.http=function(a){a=a||this;var b=new XMLHttpRequest,c=b.send,d=b.open,e=0;b.open=function(){return d.apply(b,arguments),b},b.get=function(){return b.open.apply(b,["GET"].concat(Array.prototype.slice.call(arguments)))},b.post=function(){return b.open.apply(b,["POST"].concat(Array.prototype.slice.call(arguments)))},b.put=function(){return b.open.apply(b,["PUT"].concat(Array.prototype.slice.call(arguments)))},b.delete=function(){return b.open.apply(b,["DELETE"].concat(Array.prototype.slice.call(arguments)))},b.options=function(){return b.open.apply(b,["OPTIONS"].concat(Array.prototype.slice.call(arguments)))},b.send=function(){return c.apply(b,arguments),b},b.json=function(a){return b.header("Content-Type","application/json"),c.call(b,JSON.stringify(a)),b},b.header=function(a,c){b.setRequestHeader(a,c)};var f=[],g=[],h=[],i=[],j=[];return b.onError=function(a){return a&&h.push(a),b},b.onSuccess=function(a){return a&&f.push(a),b},b.after=function(a,c,d){b.onSuccess(a),b.onError(c),b.onProgress(d)},b.onComplete=function(a){return a&&g.push(a),b},b.onStateChange=function(a){return a&&i.push(a),b},b.onProgress=function(a){return a&&j.push(a),b},b.onreadystatechange=function(c){if(4===b.readyState){var d=b.data;if(200<=b.status&&b.status<300){for(e=0;e<f.length;e++)f[e].call(a,d);for(e=0;e<$cheeta.http.successCallbacks.length;e++)$cheeta.http.successCallbacks[e].call(a,d)}else{for(d=[b.status,b.data],e=0;e<h.length;e++)h[e].apply(a,d);for(e=0;e<$cheeta.http.errorCallbacks.length;e++)$cheeta.http.errorCallbacks[e].apply(a,d)}for(e=0;e<g.length;e++)g[e].call(a,d);for(e=0;e<$cheeta.http.completeCallbacks.length;e++)$cheeta.http.completeCallbacks[e].call(a,d)}for(e=0;e<i.length;e++)i[e].apply(a,c);for(e=0;e<$cheeta.http.stateChangeCallbacks.length;e++)$cheeta.http.stateChangeCallbacks[e].apply(a,c)},b.upload.addEventListener("progress",function(b){for(e=0;e<j.length;e++)j[e].apply(a,b);for(e=0;e<$cheeta.http.progressCallbacks.length;e++)$cheeta.http.progressCallbacks[e].apply(a,b)},!1),Object.defineProperty(b,"data",{get:function(){var a=b.getResponseHeader("Content-Type");return null!=a&&a.indexOf("application/json")>-1&&null!=b.responseText&&b.responseText.length?JSON.parse(b.responseText):b.responseText},enumerable:!0,configurable:!0}),b},$cheeta.http.successCallbacks=[],$cheeta.http.completeCallbacks=[],$cheeta.http.errorCallbacks=[],$cheeta.http.stateChangeCallbacks=[],$cheeta.http.progressCallbacks=[],$cheeta.http.onError=function(a){return a&&$cheeta.http.errorCallbacks.push(a),$cheeta.http},$cheeta.http.onSuccess=function(a){return a&&$cheeta.http.successCallbacks.push(a),$cheeta.http},$cheeta.http.onComplete=function(a){return a&&$cheeta.http.completeCallbacks.push(a),$cheeta.http},$cheeta.http.onStateChange=function(a){return a&&$cheeta.http.stateChangeCallbacks.push(a),$cheeta.http},$cheeta.http.onProgress=function(a){return a&&$cheeta.http.progressCallbacks.push(a),$cheeta.http},$cheeta.http.prototype=new XMLHttpRequest,$cheeta.api=function(a){$cheeta.isString(a)&&(a={url:a});var b=function(c){function d(b,c,d,f){e.$xhr().open(b,e.$resolveUrl(),a.async||!0).send(c).after(function(a,b){null!=b&&$cheeta.copy(b,e),d.call(e,b)}).onError(function(a,b){f&&f.call(e,a.status,b)})}$cheeta.copy(c,this);var e=this;this.$resolveUrl=function(){var b=this;return a.url.replace(/{:(\w+)}/,function(a,c){var d=b[c];return d?d:""})},this.$xhr=function(a){return a?a():new $cheeta.XHR},this.$create=function(a,b){return d("POST",null,a,b),this},this.$post=function(a,b){return d("POST",this,a,b),this},this.$put=this.$update=function(a,b){return d("PUT",this,a,b),this},this.$remove=function(a,b){return d("DELETE",null,a,b),this},this.$get=function(a,b){return d("GET",null,a,b),this},this.$query=function(a,c,d,e){return b.$query(this,c).after(d).error(e)}};return b.$query=function(c,d){var e,f,g=[];g.after=function(a){return e=a,this},g.error=function(a){return f=a,this};var h=c||c instanceof b?c:new b,i=d&&$cheeta.isString(d);return h.$xhr().open("GET",$cheeta.url(h.$resolveUrl(a.url)).params(c).toString(),a.async||!0).send().after(function(a,c){if(e){if(null==d);else if(i)for(var f=d.split("."),h=0;h<f.length;h++)c=c[f[h]];for(var j=0;j<c.length;j++)g[j]=new b(c[j]);e.call(this,c,g)}}).onError(function(a,b){f&&f.call(this,a.status,b)}),g},b},function(){new $cheeta.Directive("bind.").onAttach(function(elem,attrName,parentModels){this.fn=this.fn||{},this.fn[elem]=function(){setTimeout(function(){var _tmpFn__=function(){return elem.type&&"checkbox"===elem.type.toLowerCase()?elem.checked:"input"===elem.tagName.toLowerCase()||"textarea"===elem.tagName.toLowerCase()?elem.value:elem.innerHTML};_tmpFn__=_tmpFn__||{},eval(elem.getAttribute(attrName)+"=_tmpFn__()")},0)},"input"===elem.tagName.toLowerCase()||"textarea"===elem.tagName.toLowerCase()?$cheeta.Directive.get("value.").attach(elem,attrName,parentModels):$cheeta.Directive.get("html.").attach(elem,attrName,parentModels),$cheeta(elem).on("keydown keyup change",this.fn[elem])}).onDetach(function(a,b,c){$cheeta.Directive.get("value.").detach(a,b,c),this.fn[a]&&$cheeta(a).off("keydown keyup change",this.fn[a])}).setOrder(800)}(),function(){var a=function(a,b,c){for(var d=a.getAttribute(b).split(/ *, */g),e=[],f=0;f<d.length;f++){var g=d[f],h=g.split(/ +as +/g),i=h[0],j=h.length>1?h[1]:null,k=$cheeta.model.createOrGetModel(c,i);k.alias(j),e.push(k)}return e};new $cheeta.Directive("ctrl.").setOrder(200).onAttach(a).onDetach(a),new $cheeta.Directive("model.").setOrder(200).onAttach(a).onDetach(a)}(),new $cheeta.Directive("").onModelValueChange(function(a,b,c){var d=c.substring(0===c.indexOf("data-")?5:0,c.length-1);null==a?b.removeAttribute(d):b.setAttribute(d,a)}),new $cheeta.Directive("focus.").onModelValueChange(function(a,b){b.focus(a)}),new $cheeta.Directive("for.").setOrder(100).onAttach(function(elem,attrName,parentModels){function onChange(a){!isNaN(a.detail.value)||!isNaN(a.detail.oldValue)||Array.isArray(a.detail.value)||Array.isArray(a.detail.oldValue)?handleArrayChange(a.detail.value,a.detail.oldValue):handleMapChange(a.detail.value,a.detail.oldValue)}function handleArrayChange(a,b){if((a instanceof Object||b instanceof Object)&&(a=null==a?0:a.length,b=null==b?0:b.length),b>a)for(i=b-1;i>=a;i--)rmElem=elem.previousSibling,rmElem.parentNode.removeChild(rmElem),delete model.children[i];else if(a>b)for(i=b;a>i;i++){clone=cloneElem(elem);var c=elem.getAttribute("model.");clone.setAttribute("model.",name+"["+i+"] as "+arrayVar[0]+(c?";"+c.value:""));var d=elem.getAttribute("init.");clone.setAttribute("init.",name+".$i="+i+(d?";"+d.value:"")),clone.style.display="",elem.parentNode.insertBefore(clone,elem),arrayIndexModel=new $cheeta.model.Model($cheeta.model.root,"$i"),arrayIndexModel.ref=makeref(i),$cheeta.compiler.compile(parentModels.concat(arrayIndexModel),clone)}}function handleMapChange(a,b){var c=a&&Object.keys(a)||[],d=b&&Object.keys(b)||[],e=elem,f=c.length-1;for(i=d.length-1;i>=0||f>=0;)if(d[i]!==c[f])if(f>=0){clone=cloneElem(elem),clone.setAttribute("model.",(arrayVar[1]?name+"['"+c[f]+"'] as "+arrayVar[1]:"")+(elem.getAttribute("model.")?";"+elem.getAttribute("model.").value:"")),elem.parentNode.insertBefore(clone,e),arrayIndexModel=new $cheeta.model.Model($cheeta.model.root,"$i"),arrayIndexModel.ref=makeref(i);var g=new $cheeta.model.Model($cheeta.model.root,arrayVar[0]);g.ref=makerefModel(c[f]),$cheeta.compiler.compile(parentModels.concat(arrayIndexModel,g),clone),e=clone,f--}else rmElem=e.previousSibling,rmElem.parentNode.removeChild(rmElem),delete model.children[d[i]],i--;else model.children[d[i]].valueChange(a[c[f]],b[d[i]]),f--,i--}function makeref(a){return function(){return a}}function makerefModel(a){return function(){return"'"+a+"'"}}function cloneElem(a){var b=a.cloneNode(!0);return b.removeAttribute("for."),b.removeAttribute("data-for."),b.style.display="",b}function uniqueName(){return"O"+Math.random().toString().replace(".","")}var i=0,clone,arrayIndexModel,rmElem,split=elem.getAttribute(attrName).split(/ *: */g),name=split[1],arrayVar=split[0].split(/ *, */g);split=name.split(/ +as +/g),name=split[0];var as=split.length>1?split[1]:null;if(split=name.split(/ *\.\. */),split.length>1){name=uniqueName();var m=$cheeta.model.createOrGetModel(parentModels,name);if(elem.setAttribute(attrName,arrayVar+":"+name),isNaN(split[1]))$cheeta.model.createOrGetModel(parentModels,split[1]).bind(elem,attrName,function(e){for(i=parseInt(split[0]);i<e.detail.value;i++)eval(m.ref()+"["+i+"]")!==i&&eval(m.ref()+"["+i+"] = "+i)});else for(i=parseInt(split[0]);i<parseInt(split[1]);i++)eval(m.ref()+"["+i+"]")!==i&&eval(m.ref()+"["+i+"] = "+i);this.attach(elem,attrName,parentModels)}var model=$cheeta.model.createOrGetModel(parentModels,name);return model.bind(elem,attrName,onChange),model.alias(as),1===arrayVar.length&&(model.isArray=!0),elem.style.display="none",[model]}).onDetach(function(a,b,c){var d=this.parseAttr(a.getAttribute(b)),e=d.name,f=$cheeta.model.createOrGetModel(c,e);return f.unbind(a,b),[f]}),new $cheeta.Directive("html.").onModelValueChange(function(a,b){a!==b.innerHTML&&(b.innerHTML=null==a?"":a)}),new $cheeta.Directive("init.").onAttach(function(a,b,c){this.resolveModelNames(a,b,c),$cheeta.future.evals.push(a.getAttribute(b))}),$cheeta.keyconsts={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,space:32,pause:19,"break":19,capslock:20,escape:27,esc:27,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,"down arrow":40,insert:45,"delete":46,colon:58,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,semicolon:186,comma:188,dash:189,dot:190},new $cheeta.Directive("on*").onAttach(function(elem,attrName,parentModels){this.resolveModelNames(elem,attrName,parentModels);var baseAttrName=attrName.substring(0===attrName.indexOf("data-")?7:2,attrName.length-1),split=baseAttrName.split("-");!function bindEvent(event,keys,attrName){var fn=function(){eval(elem.getAttribute(attrName))};if(0===event.indexOf("key")){for(var codes=[],i=0;i<keys.length;i++){var key=keys[i];if(1===key.length)codes[i]=key.charCodeAt(0);else if(codes[i]=$cheeta.keyconsts[key.toLowerCase()],null==codes[i]&&(codes[i]=parseInt(key),isNaN(codes[i])))throw"unknown key: "+key}var keyFn=function(a){codes.indexOf(a.which)>-1&&(fn.apply(elem,[a]),a.preventDefault(),a.stopPropagation())};elem.addEventListener(event,keyFn,!1)}else{var listenerFn=function(a){fn.apply(elem,[a]),a.preventDefault(),a.stopPropagation()};elem.addEventListener(event,listenerFn,!1)}}(split[0],split.slice(1),attrName)}),new $cheeta.Directive("onaction.").onPreAttach(function(a,b){a.setAttribute("onclick.onkeydown-space-enter.",a.getAttribute(b))}).onPostAttach(function(a,b){a.removeAttribute(b)}),new $cheeta.Directive("show.").onModelValueChange(function(a,b,c,d){a?(b.style.display="",b.__isCompiled_||(b.__isCompiled_=!0,$cheeta.compiler.compileChildren(d,b))):b.style.display="none"}),new $cheeta.Directive("text.").onModelValueChange(function(a,b){b.innerHTML="",b.appendChild(document.createTextNode(null==a?"":a))}),new $cheeta.Directive("value.").onModelValueChange(function(a,b){b.type&&"checkbox"===b.type.toLowerCase()?b.checked=a:b.value!==a&&(b.value=a||null)}),function(){$cheeta.templates=$cheeta.templates||{};var a=new $cheeta.Directive("view.").onModelValueChange(function(a,b,c,d){if(!b.__$cheetaViewIsLoading&&null!=a){b.__$cheetaViewIsLoading=!0;try{var e=$cheeta.templates[a];if(null!=e)this.loadView(b,e,d);else{var f=0===a.indexOf("/")?this.baseURL+a:a;null!=this.cache[f]?this.loadView(b,this.cache[f],d):new $cheeta.XHR(this).open("get",f).onSuccess(function(a){this.cache[f]=a.data,this.loadView(b,a.data,d)}).send()}}finally{b.__$cheetaViewIsLoading=!1}}}).setOrder(900);a.baseURL=window.location.protocol+"//"+window.location.hostname+(window.location.port&&":"+window.location.port)+window.location.pathname,a.loadView=function(a,b,c){$cheeta.compiler.uncompileChildren(c,a),a.innerHTML=b,$cheeta.compiler.compileChildren(c,a,!0)},a.cache={}}(),new $cheeta.Directive("watch*").onModelValueChange(function(v,elem){eval(elem.attr("onwatch."))}),$cheeta.hash={keyval:{},watchers:{},watch:function(a,b){a instanceof Function&&(b=a,a=""),null==this.watchers[a]&&(this.watchers[a]=[]),-1===this.watchers[a].indexOf(b)&&this.watchers[a].push(b)},unwatch:function(a,b){b instanceof Function&&(a=b,b="");var c=this.watchers[b];if(null!=c){var d=c.indexOf(a);d>-1&&c.splice(d,1)}},notify:function(a,b,c){var d=this.watchers[a];if(null!=d)for(var e=0;e<d.length;e++)d[e](b,c)},set:function(a,b){void 0===b&&(b=a,a="");var c=this.keyval[a];this.keyval[a]=b;var d=this,e=function(){var a=d.keyval[""]||"";for(var b in d.keyval)b.length&&(a+=(a.length>0?"&":"")+b+"="+d.keyval[b]);return a};window.location.hash=e(),this.notify(a,b,c)},init:function(){var a=this,b=function(){var b,c,d=window.location.hash,e=0,f="",g={};try{d=d.substring(d.length>1&&"&"===d.charAt(2)?2:1);for(var h=0;h<=d.length;h++)"&"===d.charAt(h)||h===d.length?(b=d.substring(e,h),(null==a.keyval[f]||a.keyval[f]!==b)&&(c=a.keyval[f],a.keyval[f]=b,a.notify(f,b,c)),e=h+1,g[f]=!0,f=""):"="===d.charAt(h)&&(f=d.substring(e,h),e=h+1);for(f in a.keyval)null==g[f]&&(c=a.keyval[f],delete a.keyval[f],a.notify(f,null,c))}finally{a.value=d}};b(),window.addEventListener("hashchange",function(){b()},!1)},get:function(a){return this.keyval[a||""]}},$cheeta.route=$cheeta.route||function(a,b){if(null==a)return null;var c=0,d=null;for(var e in a)0===b.indexOf(e)&&c<e.length&&(c=e.length,d=a[e]);return d};