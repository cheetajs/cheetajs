/*! cheetajs 2015-04-24 */
Object.isString=function(a){return"string"==typeof a||a instanceof String},Object.isFunction=function(a){return"function"==typeof a},Object.isBoolean=function(a){return"boolean"==typeof a},Object.isObject=function(a){return a instanceof Object},Object.isArray=function(a){return Array.isArray(a)},Object.copy=function(a,b){b=b||{};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},function(){function a(a,b){return function(){for(var c=Array.prototype.slice.call(arguments),d=0;d<c.length;d++){var e=c[d],f=e.prototype?e.prototype:e;f[a]||(f[a]=b)}}}a("attr",function(a,b){return null!=b?(this.setAttribute(a,b),this):this.getAttribute(a)||this.getAttribute("data-"+a)||a.indexOf(".",a.length-1)>-1&&this.getAttribute(a.substring(a.length-1))})(Element),a("removeAttr",function(a){return this.removeAttribute(a),this.removeAttribute("data-"+a),this})(Element),a("addClass",function(a){return null!=a&&(this.hasClass(a)||this.setAttribute("class",(this.getAttribute("class")?this.getAttribute("class")+" ":"")+a)),this})(Element),a("removeClass",function(a){return null!=a&&this.hasClass(a)&&this.setAttribute("class",this.getAttribute("class").replace(new RegExp("("+a+"$)|( "+a+")","g"),"")),this})(Element),a("hasClass",function(a){return this.getAttribute("class")&&this.getAttribute("class").split(" ").indexOf(a)>-1})(Element),a("add",function(a,b){if(a&&null!=a.length&&null!=a[0])for(var c=0;c<a.length;c++)this.add(a[c],b);else this.insertBefore(a,b&&this.childNodes[b]);return a.remove(),this})(Element),a("addBefore",function(a){if(a&&null!=a.length&&null!=a[0])for(var b=0;b<a.length;b++)this.addBefore(a[b]);else this.parentNode.insertBefore(a,this);return this})(Element,Node,Comment,Text),a("addAfter",function(a){if(a&&null!=a.length&&null!=a[0])for(var b=0;b<a.length;b++)this.addAfter(a[b]);else this.parentNode.insertBefore(a,this.nextSibling);return this})(Element,Node,Comment,Text),a("parent",function(){return this.parentNode})(Element,Node,Comment,Text),a("next",function(){return this.nextSibling})(Element,Node,Comment,Text),a("prev",function(){return this.previousSibling})(Element,Node,Comment,Text),a("nextE",function(){return this.nextElementSibling})(Element,Node,Comment,Text),a("prevE",function(){return this.previousElementSibling})(Element,Node,Comment,Text),a("remove",function(){return this.parentNode&&this.parentNode.removeChild(this),this})(Element),a("html",function(a){return void 0===a?this.innerHTML:(this.innerHTML=a,this)})(Element),a("text",function(a){return void 0===a?this.innerText:(this.innerText=a,this)})(Element),a("wrap",function(a){return this.addAfter(a),this.remove(),a.add(this),this})(Element,Node,Comment,Text),a("create",function(a){if("<"===a.charAt(0)){var b=document.createElement("div");return b.innerHTML=a,b.removeChild(b.firstChild)}return document.createElement(a)})(document),a("on",function(a,b){for(var c=a.split(" "),d=0;d<c.length;d++)c[d].length>0&&this.addEventListener(c[d],b,!1)})(Element,window,document),a("off",function(a,b){for(var c=a.split(" "),d=0;d<c.length;d++)c[d].length>0&&this.removeEventListener(c[d],b,!1)})(Element,window,document),window.E=function(a){return a instanceof Element||null!=a.nodeType?a:Object.isString(a)?document.create(a):void 0}}(),$cheeta=Oo={},$cheeta.Model=function(a,b){this.value=void 0,this.prevValue=void 0,this.parent=b,this.names=[a],this.children={},this.modelRef=null,this.ref=function(){if(null==this.modelRef)if(null==this.parent)this.modelRef=this.names[0];else{for(var a="",b=this;null!=b.parent&&null!=b.names[0];)a=(b.needBracket?"['"+b.names[0]+"']":"."+b.names[0])+a,b=b.parent;this.modelRef="."===a.charAt(0)?a.substring(1):a}return this.modelRef},this.getValue=function(){return this.parent?this.parent.value[this.names[0]]:this.value},this.setValue=function(a){this.value!==a&&(this.parent.value[this.names[0]]=a)},this.child=function(a,b,c){null==this.value&&(this.value=this.isArray?[]:{});var d=this.children[a];return void 0===d&&(d=new $cheeta.Model(a,this),d.needBracket=b,c||d.interceptProp(this.value,a),this.children[a]=d,d.value=null==this.value?void 0:this.value[a]),d},this.alias=function(a){null!=a&&a!==this.names[0]&&this.names.push(a)},this.valueChange=function(){return document.dispatchEvent(new CustomEvent("Oo-model-change-"+this.ref()+(this.refId||""),{detail:{value:this.value,prevValue:this.prevValue,target:this}})),this},this.watch=function(a,b){var c,d=this.ref()+(this.refId||"");document.addEventListener("Oo-model-change-"+d,c=function(c){b.call(a,c.detail.value,c.detail.prevValue)},!1),a.addEventListener("removed",function(){document.removeEventListener("Oo-model-change-"+d,c)},!1)},this.interceptArray=function(){if(null!=this.value){var a=new $cheeta.model.ArrayInterceptor(this);for(var b in a)if(a.hasOwnProperty(b)){if(this.value[b]===a[b])break;this.value[b]=a[b]}this.child("length",!1,!0)}},this.interceptProp=function(a,b,c){if(null!=a){var d=this,e=a[b],f=d.parent.children&&null!=d.parent.children[b],g=f?null:Object.getOwnPropertyDescriptor(a,b);try{c||this.redefineProp(a,b,g)}catch(h){if(!(h instanceof TypeError))throw h;return}a[b]=e}},this.redefineProp=function(a,b,c){var d=this;Object.defineProperty(a,b,{set:function(b){c&&c.set&&c.set.apply(a,arguments),b=c&&c.get&&c.get.apply(a)||b;var e=d.prevValue=d.value;if(e!==b&&(d.value=b,Object.isArray(b)&&d.interceptArray(),d.valueChange(),b instanceof Object))for(var f in d.children)if(d.children.hasOwnProperty(f)){var g=b[f];if(null!=e){var h=e[f];delete e[f],e[f]=h}d.children[f].interceptProp(b,f),b[f]=g}},get:function(){return c&&c.get&&c.get.apply(a)||d.value},enumerable:!0,configurable:!0})}},$cheeta.model=function(a,b){if(null==a)return $cheeta.model.root;if(void 0!==b[a])return b[a];a=a.trim();var c=a.charAt(0);if(c.toUpperCase()===c||"$"===c||"_"===c)return null;for(var d=a.split(/ *\. *| *\[ */g),e=b[d[0]]||$cheeta.model.root,f=e===$cheeta.model.root?0:1;f<d.length;f++){var g=!1,h=d[f];h.search(/\] *$/)>-1&&(g=!0,h=h.replace(/^ *'|'? *] *$/g,"")),e=e.children[h]||e.child(h,g,!1)}return e},$cheeta.model.ArrayInterceptor=function(a){function b(b,c){var d;for(d=0;d<a.value.length;d++){var e=a.child(d);e.value!==a.value[d]&&a.redefineProp(a.value,d)}if(b!==c){if(c>b)for(d=b;c>d;d++){var f=a.child(d);f.prevValue=f.value,f.value=void 0,f.valueChange()}var g=a.child("length");g.prevValue=c,g.value=b,g.valueChange()}}return{push:function(){var a=this.length,c=Array.prototype.push.apply(this,arguments),d=this.length;return b(d,a),c},pop:function(){var a=this.length,c=Array.prototype.pop.apply(this,arguments),d=this.length;return b(d,a),c},shift:function(){return this.splice(0,1)[0]},unshift:function(){var a=[].slice.apply(arguments);return a.unshift(0,0),this.splice.apply(this,a),this.length},splice:function(){var a=this.length,c=Array.prototype.splice.apply(this,arguments),d=this.length;return b(d,a),c}}},function(){var a=new $cheeta.Model("");a.value=window,$cheeta.model.root=a.child("M"),window.M=window.M||{}}(),$cheeta.watchFns=[],$cheeta.watch=function(a,b){$cheeta.watchFns.push(b);var c=document.createElement("div");c.setAttribute("style","display:none"),c.setAttribute("watch.",a),c.setAttribute("onwatch.","$cheeta.watchFns["+($cheeta.watchFns.length-1)+"]()"),document.body.appendChild(c),$cheeta.compiler.compile([$cheeta.model.root],c)},$cheeta.future=function(a,b){$cheeta.future.evals.push(b?function(){setTimeout(a,b)}:a)},$cheeta.future.evals=$cheeta.future.evals||[],window.addEventListener("load",function(){$cheeta.isInitialized||($cheeta.isInitialized=!0,$cheeta.hash.init(),$cheeta.compiler.compile(document.documentElement,{}))},!1),$cheeta.directives={directives:{},globals:[],defaults:[],add:function(a){for(var b=a.name.split(","),c=0;c<b.length;c++){var d=b[c];this.directives[d]=this.directives[d]||[],this.directives[d].push(a),d.indexOf("*",d.length-1)>-1&&this.globals.push(a),""===d&&this.defaults.push(a)}},get:function(a){var b,c=[];a=a.toLowerCase();var d=a.split(".");for(""===d[d.length-1]&&d.pop(),b=0;b<d.length;b++){var e=d[b],f=0,g=[],h=this.directives[d[b]];if(h)for(f=0;f<h.length;f++)g.push({directive:h[f],name:e});if(!g.length)for(f=0;f<this.globals.length;f++){var i=this.globals[f].name;0===e.replace(/^data-/,"").indexOf(i.substring(0,i.length-1))&&g.push({directive:this.globals[f],name:e})}c=c.concat(g)}if(!c.length)for(b=0;b<this.defaults.length;b++)c.push({directive:this.defaults[b],name:a});return c},modelVarRegExp:/(((((\. *)?[^ \.!%-\-/:-?\^\[\]{-~\t\r\n'"]+)|\[ *([^ \.!%-\-/:-?\^\[\]{-~\t\r\n'"]+|'(\\'|[^'])*') *\]) *)+\(?)|('(\\'|[^'])*')/g,reservedWords:function(){var a=[];return"abstract|else|instanceof|super|boolean|enum|int|switch|break|export|interface|synchronized|byte|extends|let|this|case|false|long|throw|catch|final|native|throws|char|finally|new|transient|class|float|null|true|const|for|package|try|continue|function|private|typeof|debugger|goto|protected|var|default|if|public|void|delete|implements|return|volatile|do|import|short|while|double|in|static|with".split("|").forEach(function(b){a[b]=!0}),a}(),reservedWordsRegExp:new RegExp("(^|\\W)("+this.reservedWords+")(\\W|$)","g"),parse:function(a,b){function c(a){var b=a.charAt(0);if("."===b)return!1;if(b.toUpperCase()===b||"$"===b||"_"===b||"window"===name)return!0;var c=a.indexOf(".");return c=-1===c?a.length:c,null!=e.reservedWords[a.substring(0,c)]}function d(a){return a.search(/\( *$/)>-1?Math.max(a.lastIndexOf("."),a.lastIndexOf("[")):a.length}var e=this,f={models:[]};return f.ref=a.replace(this.modelVarRegExp,function(a){if("'"!==a.charAt(0)&&'"'!==a.charAt(0)&&"true"!==a&&"false"!==a&&"undefined"!==a&&"null"!==a&&"NaN"!==a&&isNaN(a)){var g=a.length;if(a=a.replace(/\[ *([^0-9'"].*?)\]/g,function(c,d,h){var i=e.parse(d,b);return f.models=f.models.concat(i.models),g===a.length&&i.models.length&&(g=h),"["+i.ref+"]"}),c(a))return a;var h=d(a.substring(0,g)),i=a.substring(h),j=a.substring(0,h);0===a.indexOf(".")&&(j=b.$$last$$.names[0]+j);var k=$cheeta.model(j,b);return null!=k&&f.models.push(k),k instanceof $cheeta.Model?k.ref()+i:k}return a}),f},modelAttr:function(elem,modelRefs){return function(attr){function makeWatch(a){return function(b,c){function d(a,d){return function(){d.oldVal=d.val,d.val=attr.evaluate({},c),b.call(a,d.val,d.oldVal)}}for(var e=attr.models(c),f=0;f<e.length;f++){var g=e[f];if(g instanceof $cheeta.Model){var h=d(g,a);g.watch(elem,h),h(g,a)}}}}return Object.isString(attr)&&(attr=elem.attributes[name]),null==attr?{modelValue:function(){return void 0}}:(attr.key=attr.name.replace(/^data-/,"").replace(/\.$/,""),attr.remove=function(){elem.removeAttribute(attr.name)},attr.parseResult={},attr.resolve=function(a,b){var c=a||attr.value;return attr.parseResult[c]||(attr.parseResult[c]=$cheeta.directives.parse(c,b||modelRefs)),attr.parseResult[c]},attr.models=function(a,b){return attr.resolve(a,b).models},attr.watch=makeWatch({}),attr.evaluate=function(additionalModelRefs,ref){function addModelParams(a){a=a||{};var b;for(b in a)a.hasOwnProperty(b)&&(a[b]=a[b]);for(b in modelRefs)if(modelRefs.hasOwnProperty(b)){var c=modelRefs[b];a[b]=c instanceof $cheeta.Model?c.getValue():c}return a[$cheeta.model.root.names[0]]=$cheeta.model.root.value,a}ref=attr.resolve(ref,modelRefs).ref;var params=addModelParams(additionalModelRefs),fn,escapedVal=ref.replace(/'/g,"\\'"),keys=Object.keys(params);eval("var fn = function("+keys.join(",")+"){return eval('"+escapedVal+"');};");var paramValues=keys.map(function(a){return params[a]});console.log("eval",ref,paramValues);try{return fn.apply(elem,paramValues)}catch(e){throw console.error&&console.error(e.constructor.prototype.toString(),e.message||e,'"'+ref+'"',attr,elem,params),e}},attr)}}},$cheeta.directive=function(a){return Object.isString(a)?$cheeta.directives.get(a):(a.linkFn=function(b,c,d){var e=$cheeta.directives.modelAttr(b,d);return b.M=d,a.link.call(this,b,e(c),e,d)},$cheeta.directives.add(a),a)},new MutationObserver(function(a){a.forEach(function(a){for(var b=a.removedNodes,c=0;c<b.length;c++)a.target.dispatchEvent(new CustomEvent("removed",{detail:{target:b.item(c)}}))})}),$cheeta.compiler={recursiveCompile:function(a,b,c,d,e){if(a){var f=!1;if(!e&&1===a.nodeType){if("script"===a.tagName.toLowerCase())if(!c||null!=a.parentNode&&"head"===a.parentNode.tagName.toLowerCase()||null!=a.type&&""!==a.type&&"text/javascript"!==a.type)"text/cheeta-template"===a.type&&($cheeta.templates[a.getAttribute("id")]=a.innerHTML||"");else{var g=a.innerHTML||"",h=document.getElementsByTagName("head")[0]||document.documentElement,i=document.createElement("script");i.type="text/javascript",i.appendChild(document.createTextNode(g)),h.insertBefore(i,h.firstChild),h.removeChild(i)}var j=this.compileAllDirectives(a,b);f=j.skip,b=j.refs}f||this.recursiveCompile(a.firstChild,b,c),d||this.recursiveCompile(a.nextSibling,b,c)}},compileAllDirectives:function(a,b){var c=this.getAllDirectivesWithAttr(a);return this.compileDirectives(a,c,b)},compileDirectives:function(a,b,c){for(var d=!1,e=0;e<b.length;e++){var f=b[e],g=f.directive.linkFn(a,{name:f.name,value:f.value},c);g&&(c=Object.copy(c),Object.copy(g,c)),d=d||f.directive.isTemplate}return{refs:c,skip:d}},compileAttr:function(a,b,c){return this.compileDirectives(a,this.getDirectives(a,b),c)},getDirectives:function(a,b){var c=[];if(b.name.indexOf(".",b.name.length-1)>-1)for(var d=$cheeta.directives.get(b.name),e=0;e<d.length;e++)d[e].value=b.value,c.push(d[e]);return c},getAllDirectivesWithAttr:function(a){var b,c,d=[],e=a.attributes;for(e[-1]={name:a.tagName},c=-1;c<e.length;c++)b=e[c],d=d.concat(this.getDirectives(a,b));return d.sort(function(a,b){return(a.directive.order||1e3)-(b.directive.order||1e3)}),d},doCompile:function(){this.recursiveCompile.apply(this,arguments),this.runFutures()},compile:function(a,b,c){this.doCompile(a,b,c,!0)},compileChildren:function(a,b,c){this.doCompile(a,b,c,!0,!0)},runFutures:function(){var runs=$cheeta.future.evals;$cheeta.future.evals=[];for(var i=0;i<runs.length;i++){var expr=runs[i];Object.isFunction(expr)?expr():eval(expr)}}},$cheeta.url=function(a){var b=document.createElement("a");return b.href=a,b.param=function(a,c){return b.search+=(b.search.indexOf("?")>-1?"&":"?")+a+"="+c,b},b.params=function(a){if(a)for(var c in a)$cheeta.isFunction(a[c])||b.param(c,a[c]);return b},b},$cheeta.http=function(a){a=a||this;var b=new XMLHttpRequest,c=b.send,d=b.open,e=0;b.open=function(){return d.apply(b,arguments),b},b.get=function(){return b.open.apply(b,["GET"].concat(Array.prototype.slice.call(arguments)))},b.post=function(){return b.open.apply(b,["POST"].concat(Array.prototype.slice.call(arguments)))},b.put=function(){return b.open.apply(b,["PUT"].concat(Array.prototype.slice.call(arguments)))},b["delete"]=function(){return b.open.apply(b,["DELETE"].concat(Array.prototype.slice.call(arguments)))},b.options=function(){return b.open.apply(b,["OPTIONS"].concat(Array.prototype.slice.call(arguments)))},b.send=function(){return c.apply(b,arguments),b},b.json=function(a){return b.header("Content-Type","application/json"),c.call(b,JSON.stringify(a)),b},b.header=function(a,c){b.setRequestHeader(a,c)};var f=[],g=[],h=[],i=[],j=[];return b.onError=function(a){return a&&h.push(a),b},b.onSuccess=function(a){return a&&f.push(a),b},b.after=function(a,c,d){b.onSuccess(a),b.onError(c),b.onProgress(d)},b.onComplete=function(a){return a&&g.push(a),b},b.onStateChange=function(a){return a&&i.push(a),b},b.onProgress=function(a){return a&&j.push(a),b},b.onreadystatechange=function(c){if(4===b.readyState){var d=b.data;if(200<=b.status&&b.status<300){for(e=0;e<f.length;e++)f[e].call(a,d);for(e=0;e<$cheeta.http.successCallbacks.length;e++)$cheeta.http.successCallbacks[e].call(a,d)}else{for(d=[b.status,b.data],e=0;e<h.length;e++)h[e].apply(a,d);for(e=0;e<$cheeta.http.errorCallbacks.length;e++)$cheeta.http.errorCallbacks[e].apply(a,d)}for(e=0;e<g.length;e++)g[e].call(a,d);for(e=0;e<$cheeta.http.completeCallbacks.length;e++)$cheeta.http.completeCallbacks[e].call(a,d)}for(e=0;e<i.length;e++)i[e].apply(a,c);for(e=0;e<$cheeta.http.stateChangeCallbacks.length;e++)$cheeta.http.stateChangeCallbacks[e].apply(a,c)},b.upload.addEventListener("progress",function(b){for(e=0;e<j.length;e++)j[e].apply(a,b);for(e=0;e<$cheeta.http.progressCallbacks.length;e++)$cheeta.http.progressCallbacks[e].apply(a,b)},!1),Object.defineProperty(b,"data",{get:function(){var a=b.getResponseHeader("Content-Type");return null!=a&&a.indexOf("application/json")>-1&&null!=b.responseText&&b.responseText.length?JSON.parse(b.responseText):b.responseText},enumerable:!0,configurable:!0}),b},$cheeta.http.successCallbacks=[],$cheeta.http.completeCallbacks=[],$cheeta.http.errorCallbacks=[],$cheeta.http.stateChangeCallbacks=[],$cheeta.http.progressCallbacks=[],$cheeta.http.onError=function(a){return a&&$cheeta.http.errorCallbacks.push(a),$cheeta.http},$cheeta.http.onSuccess=function(a){return a&&$cheeta.http.successCallbacks.push(a),$cheeta.http},$cheeta.http.onComplete=function(a){return a&&$cheeta.http.completeCallbacks.push(a),$cheeta.http},$cheeta.http.onStateChange=function(a){return a&&$cheeta.http.stateChangeCallbacks.push(a),$cheeta.http},$cheeta.http.onProgress=function(a){return a&&$cheeta.http.progressCallbacks.push(a),$cheeta.http},$cheeta.http.prototype=new XMLHttpRequest,$cheeta.api=function(a){$cheeta.isString(a)&&(a={url:a});var b=function(c){function d(b,c,d,f){e.$xhr().open(b,e.$resolveUrl(),a.async||!0).send(c).after(function(a,b){null!=b&&$cheeta.copy(b,e),d.call(e,b)}).onError(function(a,b){f&&f.call(e,a.status,b)})}$cheeta.copy(c,this);var e=this;this.$resolveUrl=function(){var b=this;return a.url.replace(/{:(\w+)}/,function(a,c){var d=b[c];return d?d:""})},this.$xhr=function(a){return a?a():new $cheeta.XHR},this.$create=function(a,b){return d("POST",null,a,b),this},this.$post=function(a,b){return d("POST",this,a,b),this},this.$put=this.$update=function(a,b){return d("PUT",this,a,b),this},this.$remove=function(a,b){return d("DELETE",null,a,b),this},this.$get=function(a,b){return d("GET",null,a,b),this},this.$query=function(a,c,d,e){return b.$query(this,c).after(d).error(e)}};return b.$query=function(c,d){var e,f,g=[];g.after=function(a){return e=a,this},g.error=function(a){return f=a,this};var h=c||c instanceof b?c:new b,i=d&&$cheeta.isString(d);return h.$xhr().open("GET",$cheeta.url(h.$resolveUrl(a.url)).params(c).toString(),a.async||!0).send().after(function(a,c){if(e){if(null==d);else if(i)for(var f=d.split("."),h=0;h<f.length;h++)c=c[f[h]];for(var j=0;j<c.length;j++)g[j]=new b(c[j]);e.call(this,c,g)}}).onError(function(a,b){f&&f.call(this,a.status,b)}),g},b},$cheeta.directive({name:"watch*",link:function(elem,attr){attr.watch(function(){eval(elem.attr("onwatch"))})}}),$cheeta.directive({name:"value",link:function(a,b){b.watch(function(b){a.type&&"checkbox"===a.type.toLowerCase()?a.checked=b:a.value!==b&&(a.value=b||null)})}}),$cheeta.directive({name:"bind",order:800,link:function(a,b){function c(){return a.type&&"checkbox"===a.type.toLowerCase()?a.checked:"input"===a.tagName.toLowerCase()||"textarea"===a.tagName.toLowerCase()?a.value:a.innerHTML}function d(b){a.on("change keydown keyup",function(){for(var a=0;a<b.length;a++)b[a].setValue(c())})}$cheeta.directives.get("value")[0].directive.link(a,b),d(b.models())}}),$cheeta.directive({name:"text",link:function(a,b){b.watch(function(b){a.innerHTML="",a.appendChild(document.createTextNode(null==b?"":b))})}}),$cheeta.directive({name:"html",link:function(a,b){b.watch(function(b){b!==a.innerHTML&&(a.innerHTML=null==b?"":b)})}}),$cheeta.directive({name:"show",isTemplate:!0,link:function(a,b,c){b.watch(function(b){b?(a.style.display="",a.getAttribute("OoCompiled")||(a.setAttribute("OoCompiled",!0),$cheeta.compiler.compileChildren(a,c))):a.style.display="none"})}}),$cheeta.directive({name:"onaction",link:function(a,b,c,d){$cheeta.compiler.compileAttr(a,{name:"onclick.onkeydown-space-enter.",value:b.value},d)}}),$cheeta.directive({name:"init",link:function(a,b){$cheeta.future(b.evaluate)}}),$cheeta.directive({name:"focus",link:function(a,b){b.watch(function(b){a.focus(b)})}}),$cheeta.directive({name:"",link:function(a,b){b.watch(function(c){var d=b.key;null==c?a.removeAttribute(d):a.setAttribute(d,c)})}}),$cheeta.directive({name:"model",order:200,lastId:0,link:function(a,b,c,d){function e(a,c){return function(){a.value=b.evaluate({},c),a.valueChange()}}for(var f=b.value.split(/ *[,;] */g),g={},h=0;h<f.length;h++)if(""!==f[h]){var i=f[h].split(/ *: */g),j=i[1]||i[0],k=i.length>1?i[0]:null;if(k){var l=new $cheeta.Model(k,null);l.refId=this.lastId++,l.value=b.evaluate({},j),b.watch(e(l,j),j),g[k]=l,g.$$last$$=l}else{var m=$cheeta.model(j,d);g[m.names[0]]=m,g.$$last$$=m}}return g}}),$cheeta.directive({name:"for",isTemplate:!0,order:100,link:function(a,b,c,d){function e(b,c){return null!=a.parent()&&(a.remove(),c=0,Object.isArray(b))?(i.child("length").watch(a,f),b=b.length,void f(b,c)):void f(b,c,!0)}function f(b,c,e){var f;if(b>c)for(f=c;b>f;f++){var i=a.cloneNode(!0);i.attr("model.",i.attr("model.").replace("<M>",e?f+1:h.ref+"["+f+"]")),g.addBefore(i),h.index&&(d[h.index]=f),$cheeta.compiler.compile(i,d)}else if(c>b)for(f=b;c>f;f++)g.prev().remove()}var g=document.createComment(a.outerHTML);a.addAfter(g);var h=this.parse(b.value);a.removeAttr("for.");var i=$cheeta.model(h.ref,d);a.attr("model.",h.variable+":<M>;"+(a.attr("model.")||"")),i.watch(a,e),null!=i.value&&e(i.value,null)},parse:function(a){var b=a.split(/ *: */g),c=b[1],d=b[0].split(/ *, */g);return{ref:c,index:d.length>1?d[0]:null,variable:d[d.length-1]}}}),$cheeta.directive({name:"on*",keyconsts:{backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,space:32,pause:19,"break":19,capslock:20,escape:27,esc:27,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,"down arrow":40,insert:45,"delete":46,colon:58,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,semicolon:186,comma:188,dash:189,dot:190},link:function(a,b){var c=b.key.split("-");this.bindEvent(a,b,c[0].substring(2),c.slice(1))},bindEvent:function(a,b,c,d){var e=function(a){var c=b.evaluate({$event:a});return null!=c?(c.preventDefault!==!1&&a.preventDefault(),c.stopPropagation!==!1&&a.stopPropagation(),Object.isObject(c)?c.value:c):void 0};if(0===c.indexOf("key")){var f=this.extractKeyCodes(d);f.length&&(e=function(a){f.indexOf(a.which)>-1&&e.call(this,a)})}a.addEventListener(c,e,!1)},extractKeyCodes:function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];if(1===d.length)b[c]=d.charCodeAt(0);else if(b[c]=this.keyconsts[d.toLowerCase()],null==b[c]&&(b[c]=parseInt(d),isNaN(b[c])))throw"unknown key: "+d}return b}}),$cheeta.directive({name:"test",order:1e4,link:function(a,b,c){a.addClass("test");var d=this;$cheeta.future(function(){for(var c=a.previousElementSibling;c&&c.hasClass("test");)c=c.previousElementSibling;for(var e=[];c&&!c.hasClass("test");)e.push(c),c=c.previousElementSibling;e=e.reverse();var f=e[0];if(e.forEach(function(a,b){f[b]=a}),f)try{var g=b.evaluate({$elem:f,Is:d.Is});(g===!1||null!=g&&g.length)&&d.showError(a,b,g)}catch(h){if(d.showError(a,b,h.message||h),!(h.message||h).search(/fail/gi))throw h}},c("delay").modelValue()||0)},showError:function(elem,attr,val){var info=attr.value+" ["+attr.models().map(function(a){return a.ref()}).filter(function(a){return 0!==a.indexOf("Is")}).map(function(r){return eval(r)}).join(", ")+"]";elem.addClass("error").attr("style","color: #C52121;padding-left:20px").text(val).attr("title",info);var flip=!0;elem.on("click",function(){flip?elem.addAfter(new E("span").attr("style","color: #C52121;padding-left: 10px").addClass("error").text(elem.attr("title"))):elem.next().remove(),flip=!flip})},Is:{eq:function(){this.verify("eq",Array.prototype.slice.call(arguments),function(a,b){return a===b})},eql:function(){this.verify("eq",Array.prototype.slice.call(arguments),function(a,b){return(null==a?"":a)===(null==b?"":b)})},verify:function(a,b,c){function d(a){return f.toStr(a)}for(var e=b[0],f=this,g=1;g<b.length;g++){if(!c(e,b[g]))throw"*Fail "+a+" "+b.map(d).join(", ");e=b[g]}},toStr:function(a){return null===a?"<null>":void 0===a?"<undefined>":Object.isString(a)?'"'+a+'"':a}}}),$cheeta.directive({name:"view,template",order:900,baseURL:window.location.protocol+"//"+window.location.hostname+(window.location.port&&":"+window.location.port)+window.location.pathname,loadView:function(a,b,c){a.innerHTML=b,$cheeta.compiler.compileChildren(a,c,!0)},cache:{},templates:{},loadingElements:{},link:function(a,b,c,d){var e=this;b.watch(function(b){if(!e.loadingElements[a]&&null!=b){e.loadingElements[a]=!0;try{var c=e.templates[b];if(null!=c)e.loadView(a,c,d);else{var f=0===b.indexOf("/")?e.baseURL+b:b;null!=e.cache[f]?e.loadView(a,e.cache[f],d):$cheeta.http(this).get(f).send().after(function(b){e.cache[f]=b,e.loadView(a,b,d)})}}finally{delete e.loadingElements[a]}}})}}),$cheeta.hash={keyval:{},watchers:{},watch:function(a,b){a instanceof Function&&(b=a,a=""),null==this.watchers[a]&&(this.watchers[a]=[]),-1===this.watchers[a].indexOf(b)&&this.watchers[a].push(b)},unwatch:function(a,b){b instanceof Function&&(a=b,b="");var c=this.watchers[b];if(null!=c){var d=c.indexOf(a);d>-1&&c.splice(d,1)}},notify:function(a,b,c){var d=this.watchers[a];if(null!=d)for(var e=0;e<d.length;e++)d[e](b,c)},set:function(a,b){void 0===b&&(b=a,a="");var c=this.keyval[a];this.keyval[a]=b;var d=this,e=function(){var a=d.keyval[""]||"";for(var b in d.keyval)b.length&&(a+=(a.length>0?"&":"")+b+"="+d.keyval[b]);return a};window.location.hash=e(),this.notify(a,b,c)},init:function(){var a=this,b=function(){var b,c,d=window.location.hash,e=0,f="",g={};try{d=d.substring(d.length>1&&"&"===d.charAt(2)?2:1);for(var h=0;h<=d.length;h++)"&"===d.charAt(h)||h===d.length?(b=d.substring(e,h),(null==a.keyval[f]||a.keyval[f]!==b)&&(c=a.keyval[f],a.keyval[f]=b,a.notify(f,b,c)),e=h+1,g[f]=!0,f=""):"="===d.charAt(h)&&(f=d.substring(e,h),e=h+1);for(f in a.keyval)null==g[f]&&(c=a.keyval[f],delete a.keyval[f],a.notify(f,null,c))}finally{a.value=d}};b(),window.addEventListener("hashchange",function(){b()},!1)},get:function(a){return this.keyval[a||""]}},$cheeta.route=$cheeta.route||function(a,b){if(null==a)return null;var c=0,d=null;for(var e in a)0===b.indexOf(e)&&c<e.length&&(c=e.length,d=a[e]);return d};